# DarkRepos Wiki Integration

This document describes how to set up and use the DarkRepos Games Wiki integration in GameInfoTools.

## Overview

**DarkRepos Games Wiki** (https://games.darkrepos.com) is a community wiki for ROM hacking documentation, disassemblies, and retro game data. Unlike some other ROM hacking wikis, **DarkRepos allows AI-assisted content**, making it the ideal target for GameInfoTools output.

## Features

- ‚úÖ **AI Content Allowed** - Upload content directly from GameInfoTools
- üîÑ **Two-Way Sync** - Pull and push wiki content
- üìä **Status Tracking** - Track local vs remote changes
- üìù **Change Markers** - Track content origin (AI-generated, imported, human-edited)
- üîí **Bot Password Auth** - Secure API access via bot passwords

## Setup

### 1. Create a Wiki Account

1. Go to https://games.darkrepos.com
2. Create an account or log in
3. Navigate to **Special:BotPasswords**
4. Create a new bot password with these permissions:
   - Basic rights
   - Edit existing pages
   - Create, edit, and move pages
   - High-volume editing (optional, for batch uploads)

### 2. Configure GameInfoTools

The DarkRepos profile is configured by default. If you need to update credentials:

```csharp
var profileManager = new WikiProfileManager();
var profile = WikiProfileManager.CreateDarkReposProfile(
    username: "YourUsername",
    botPassword: "YourBotPassword"
);
profileManager.AddOrUpdateProfile(profile);
profileManager.SetDefaultProfile("darkrepos");
```

### 3. Using the UI

1. Open GameInfoTools UI
2. Navigate to the **DarkRepos** panel
3. Enter your credentials in the Login tab
4. Select a folder containing `.wikitext` files
5. Use Pull/Push to sync content

## Content Workflow

### Creating Wiki Content

1. **Generate Content** - Use Wiki Editor or other tools to create wikitext
2. **Save Locally** - Save as `.wikitext` files in your wiki directory
3. **Review (Optional)** - Review content for accuracy
4. **Upload** - Push to DarkRepos Wiki

### Syncing Changes

1. **Check Status** - Click "Check Status" to compare local vs remote
2. **Pull Changes** - Download remote updates to local files
3. **Push Changes** - Upload local changes to wiki
4. **Resolve Conflicts** - If both changed, manually merge

## Status Icons

| Icon | Status | Description |
|------|--------|-------------|
| ‚úì | In Sync | Local matches remote |
| üìÑ | Local Only | Not on wiki yet |
| ‚òÅÔ∏è | Remote Only | On wiki, not saved locally |
| üìù | Local Modified | Local changes not uploaded |
| ‚¨áÔ∏è | Remote Modified | Wiki has newer version |
| ‚ö†Ô∏è | Conflict | Both local and remote changed |

## Change Tracking Markers

GameInfoTools adds HTML comment markers to track content origin:

```wikitext
<!-- @CHANGE:AiGenerated:2024-01-15T10:30:00Z:Generated by ROM Analyzer -->
Content here...
<!-- @CHANGE_END -->
```

Marker types:
- `AiGenerated` - Created by AI/automated tools
- `Imported` - Pulled from wiki
- `Modified` - Human modifications
- `Reviewed` - Marked as reviewed

These markers are **automatically stripped** when uploading to the wiki.

## API Integration

### MediaWikiClient

```csharp
using GameInfoTools.Wiki;

// Create client
var config = new MediaWikiConfig {
    BaseUrl = "https://games.darkrepos.com",
    Username = "YourBot",
    BotPassword = "YourBotPassword"
};
var client = new MediaWikiClient(config);

// Login
var loginResult = await client.LoginAsync();

// Get a page
var page = await client.GetPageAsync("Dragon Warrior IV");

// Edit a page
var editResult = await client.EditPageAsync(
    "Dragon Warrior IV",
    content,
    "Updated monster data"
);
```

### WikiSyncManager

```csharp
var syncManager = new WikiSyncManager("./wiki-content");

// Scan directory for wikitext files
var files = syncManager.ScanDirectory("./wiki-content", PathToTitle);

// Check sync status
var status = await syncManager.CheckSyncStatusAsync(filePath, client);

// Mark as reviewed (optional)
syncManager.MarkAsReviewed(filePath, "John", "Verified monster stats");
```

## Wiki Profile Configuration

DarkRepos is configured with these settings:

```csharp
new WikiProfile {
    Id = "darkrepos",
    Name = "DarkRepos Games Wiki",
    Description = "ROM hacking documentation - AI content allowed",
    Config = new MediaWikiConfig {
        BaseUrl = "https://games.darkrepos.com",
        ApiPath = "/w/api.php"
    },
    ContentPolicy = new WikiContentPolicy {
        AllowsAiContent = true,
        RequireReviewBeforeUpload = false,
        MinEditDelaySeconds = 0,
        MaxEditsPerHour = 0  // No limit
    }
}
```

## Comparison with Other Wikis

| Wiki | AI Content | Review Required | Rate Limits |
|------|------------|-----------------|-------------|
| **DarkRepos** | ‚úÖ Allowed | ‚ùå No | None |
| Data Crystal | ‚ùå Forbidden | ‚úÖ Yes | 30/hour |
| TCRF | ‚ùå Forbidden | ‚úÖ Yes | 30/hour |

## Troubleshooting

### Login Failed

- Verify bot password is correct (not your main password)
- Check bot password hasn't expired
- Ensure bot password has required permissions

### Push Failed

- Check you're logged in
- Verify page isn't protected
- Check for edit conflicts (pull first)

### Missing Pages

- Verify page title format (spaces vs underscores)
- Check namespace prefix if needed

## Best Practices

1. **Use Descriptive Summaries** - Edit summaries help track changes
2. **Organize by Game** - Use consistent page naming
3. **Link Related Pages** - Cross-reference ROM/RAM maps
4. **Keep Local Backups** - Save wikitext files locally
5. **Test Changes** - Preview before major uploads

## Command Line Usage

```bash
# Push a single file
git wiki push "Dragon Warrior IV - ROM Map.wikitext"

# Pull latest version
git wiki pull "Dragon Warrior IV - ROM Map"

# Check status of all wiki files
git wiki status ./wiki-content/

# Batch upload
git wiki push-all ./wiki-content/ --summary "Batch update"
```

## See Also

- [GameInfo README](../README.md)
- [MediaWiki API Documentation](https://www.mediawiki.org/wiki/API:Main_page)
- [DarkRepos Games Wiki](https://games.darkrepos.com)

{{DISPLAYTITLE:Soul Blazer - Technical Reference}}
This is the '''technical reference''' for '''[[Soul Blazer]]''' (SNES), providing detailed hardware specifications, memory layouts, and system documentation.

==System Overview==

===Hardware Target===
{| class="wikitable"
! Component !! Specification
|-
| Platform || Super Nintendo Entertainment System
|-
| CPU || Ricoh 5A22 (65C816 @ 3.58 MHz)
|-
| PPU || S-PPU1 + S-PPU2 (256×224 resolution)
|-
| APU || Sony SPC700 @ 1.024 MHz
|-
| Work RAM || 128 KB
|-
| Video RAM || 64 KB
|-
| OAM || 544 bytes (128 sprites)
|-
| CGRAM || 512 bytes (256 colors)
|-
| Audio RAM || 64 KB
|}

===Cartridge===
{| class="wikitable"
! Property !! Value
|-
| ROM Size || 1 MB (8 Mbit)
|-
| SRAM Size || 8 KB (battery-backed)
|-
| Mapper || LoROM (Mode $20)
|-
| Enhancement Chip || None
|-
| CIC Region || NTSC-U (Americas)
|}

==Memory Map==

===CPU Address Space===
{| class="wikitable"
! Range !! Description
|-
| $00:0000-$00:1FFF || Mirror of $7E:0000-$7E:1FFF (low WRAM)
|-
| $00:2000-$00:5FFF || Hardware registers (PPU, APU, DMA)
|-
| $00:6000-$00:7FFF || Unused / expansion
|-
| $00:8000-$00:FFFF || ROM Bank 00 (first 32KB)
|-
| $01:8000-$1F:FFFF || ROM Banks 01-1F
|-
| $70:0000-$70:1FFF || SRAM (8KB, battery-backed)
|-
| $7E:0000-$7F:FFFF || Work RAM (128KB)
|}

===LoROM Mapping===
<pre>
File Offset = (Bank × $8000) + (Address & $7FFF)
CPU Address = $808000 + File Offset
             (Bank | $80) << 16 | $8000 | (Offset & $7FFF)
</pre>

Example conversions:
{| class="wikitable"
! File Offset !! CPU Address !! Bank !! Description
|-
| $000000 || $00:8000 || 00 || Reset vector entry
|-
| $008000 || $01:8000 || 01 || Bank 01 start
|-
| $078000 || $0F:8000 || 0F || Audio driver
|-
| $0F8000 || $1F:8000 || 1F || Last bank
|}

==PPU Configuration==

===Graphics Modes===
Soul Blazer uses '''Mode 1''' (4BPP BG1/BG2, 2BPP BG3):
{| class="wikitable"
! Layer !! Color Depth !! Tile Size !! Usage
|-
| BG1 || 16 colors || 8×8 || Main playfield
|-
| BG2 || 16 colors || 8×8 || Overlay/parallax
|-
| BG3 || 4 colors || 8×8 || Status/HUD
|-
| OBJ || 16 colors || 8×8/16×16 || Sprites
|}

===VRAM Layout===
{| class="wikitable"
! Address !! Size !! Content
|-
| $0000 || 8KB || BG1 tileset (4BPP)
|-
| $2000 || 8KB || BG2 tileset (4BPP)
|-
| $4000 || 4KB || Sprite tileset (lower)
|-
| $5000 || 4KB || BG3 font/HUD tiles (2BPP)
|-
| $6000 || 4KB || Sprite tileset (upper)
|-
| $7000 || 2KB || BG1 tilemap
|-
| $7800 || 2KB || BG2 tilemap
|-
| $8000 || 32KB || Extended graphics
|}

===OAM Structure===
Each sprite entry is 4 bytes:
<pre>
Byte 0: X position (low 8 bits)
Byte 1: Y position
Byte 2: Tile index
Byte 3: Attributes
  Bit 7:   V-flip
  Bit 6:   H-flip
  Bits 5-4: Priority (0-3)
  Bits 3-1: Palette (0-7)
  Bit 0:   Name table (high bit of tile)
</pre>

High table (bit 9 of X, size bit) in upper OAM.

==DMA Configuration==

===HDMA Channels===
{| class="wikitable"
! Channel !! Target !! Usage
|-
| 0 || $2100 (INIDISP) || Screen brightness fades
|-
| 1 || $2105 (BGMODE) || Mode changes
|-
| 2 || $210D (BG1HOFS) || Parallax scrolling
|-
| 3 || $2111 (BG2HOFS) || Parallax scrolling
|}

===General DMA===
Used for:
* VRAM transfers (tileset loading)
* OAM updates
* CGRAM (palette) updates

==Interrupt Handlers==

===NMI ($8342)===
Executed every VBlank (60 Hz NTSC):
<pre>
1. Push registers
2. Increment frame counter ($7E0040)
3. Check input ($4218-$421F)
4. Update OAM from shadow ($7E0400)
5. Update CGRAM if dirty
6. Process audio queue
7. Pop registers, RTI
</pre>

===IRQ ($85A5)===
Used for:
* Mid-screen effects (scanline interrupts)
* Timing-critical audio sync

==Input Handling==

===Controller Registers===
{| class="wikitable"
! Address !! Description
|-
| $4016 || Controller 1 data (active low)
|-
| $4017 || Controller 2 data
|-
| $4218 || Controller 1 current state (low)
|-
| $4219 || Controller 1 current state (high)
|}

===Button Masks===
{| class="wikitable"
! Bit !! Button !! Mask
|-
| 15 || B || $8000
|-
| 14 || Y || $4000
|-
| 13 || Select || $2000
|-
| 12 || Start || $1000
|-
| 11 || Up || $0800
|-
| 10 || Down || $0400
|-
| 9 || Left || $0200
|-
| 8 || Right || $0100
|-
| 7 || A || $0080
|-
| 6 || X || $0040
|-
| 5 || L || $0020
|-
| 4 || R || $0010
|}

===Game Control Mapping===
{| class="wikitable"
! Button !! Action
|-
| A || Attack/Confirm
|-
| B || Magic/Cancel
|-
| X || Open Menu
|-
| Y || Use Item
|-
| L || Quick Magic Select
|-
| R || Quick Item Select
|-
| Start || Pause
|-
| Select || Status Screen
|}

==SRAM Save Format==

===Save File Structure===
SRAM is 8KB ($70:0000-$70:1FFF), divided into 3 save slots:
{| class="wikitable"
! Offset !! Size !! Content
|-
| $0000 || $0800 || Save Slot 1
|-
| $0800 || $0800 || Save Slot 2
|-
| $1000 || $0800 || Save Slot 3
|-
| $1800 || $0800 || Backup / System data
|}

===Slot Structure (2KB each)===
{| class="wikitable"
! Offset !! Size !! Description
|-
| $0000 || 4 || Magic number ("SOUL")
|-
| $0004 || 2 || Checksum
|-
| $0006 || 8 || Player name (null-padded)
|-
| $000E || 2 || Play time (minutes)
|-
| $0010 || 1 || Current area ID
|-
| $0011 || 1 || Current map ID
|-
| $0012 || 2 || Player X position
|-
| $0014 || 2 || Player Y position
|-
| $0016 || 2 || Current HP
|-
| $0018 || 2 || Maximum HP
|-
| $001A || 2 || Current EXP (low)
|-
| $001C || 2 || Current EXP (high)
|-
| $001E || 1 || Current Level
|-
| $001F || 1 || Equipped Sword
|-
| $0020 || 1 || Equipped Armor
|-
| $0021 || 1 || Equipped Magic
|-
| $0022 || 2 || GEM count
|-
| $0024 || 2 || Attack power
|-
| $0026 || 2 || Defense power
|-
| $0028 || 1 || Sword inventory flags
|-
| $0029 || 1 || Armor inventory flags
|-
| $002A || 1 || Magic inventory flags
|-
| $002B || 1 || Item inventory flags
|-
| $002C || 1 || Emblem flags
|-
| $002D || 1 || Stone count
|-
| $002E || 16 || Soul flags (area 1)
|-
| $003E || 16 || Soul flags (area 2)
|-
| $004E || 16 || Soul flags (area 3)
|-
| $005E || 16 || Soul flags (area 4)
|-
| $006E || 16 || Soul flags (area 5)
|-
| $007E || 16 || Soul flags (area 6)
|-
| $008E || 16 || Soul flags (area 7 - World of Evil)
|-
| $009E || 16 || Lair cleared flags (area 1)
|-
| ... || ... || Lair flags continue...
|-
| $0200 || $0600 || Event flags, chest states, NPC states
|}

===Checksum Calculation===
<pre>
sum = 0
for offset in range(0x0006, 0x0800):
    sum += sram[slot_base + offset]
checksum = sum & 0xFFFF
</pre>

==Compression Formats==

===RLE (Run-Length Encoding)===
Used for tilemap data:
<pre>
If high bit clear: Raw bytes follow
  [0nnnnnnn] [n+1 bytes of data]

If high bit set: Repeat byte
  [1nnnnnnn] [byte] - Repeat byte (n+1) times
</pre>

===LZ77===
Used for graphics data:
<pre>
[Header: 3 bytes]
  Bytes 0-1: Uncompressed size (little-endian)
  Byte 2: Flags

[Data blocks]
  Flag byte: 8 bits indicating literal (0) or reference (1)
  
  Literal: 1 byte copied directly
  
  Reference: 2 bytes
    Bits 15-12: Length - 3 (0-15 = 3-18 bytes)
    Bits 11-0: Offset back into output buffer
</pre>

==Entity System==

===Entity Slot Structure (32 bytes)===
{| class="wikitable"
! Offset !! Size !! Description
|-
| $00 || 1 || Entity type (0 = empty)
|-
| $01 || 1 || Subtype / variant
|-
| $02 || 2 || X position (16.0 fixed)
|-
| $04 || 2 || Y position (16.0 fixed)
|-
| $06 || 2 || X velocity (8.8 fixed)
|-
| $08 || 2 || Y velocity (8.8 fixed)
|-
| $0A || 2 || Current HP
|-
| $0C || 2 || Maximum HP
|-
| $0E || 1 || Direction (0-7)
|-
| $0F || 1 || Animation state
|-
| $10 || 1 || Animation frame
|-
| $11 || 1 || Animation timer
|-
| $12 || 1 || AI state
|-
| $13 || 1 || AI timer
|-
| $14 || 2 || Target X (for pathfinding)
|-
| $16 || 2 || Target Y
|-
| $18 || 1 || Status flags
|-
| $19 || 1 || Collision flags
|-
| $1A || 1 || Attack power
|-
| $1B || 1 || Defense power
|-
| $1C || 2 || Sprite base address
|-
| $1E || 2 || User data / parent link
|}

===Entity Types===
{| class="wikitable"
! Type !! Description
|-
| $00 || Empty slot
|-
| $01 || Player
|-
| $02-$3F || Enemies
|-
| $40-$5F || NPCs
|-
| $60-$7F || Projectiles
|-
| $80-$9F || Items / pickups
|-
| $A0-$BF || Effects
|-
| $C0-$FF || Special / bosses
|}

==Collision System==

===Collision Types===
{| class="wikitable"
! Value !! Type !! Behavior
|-
| $00 || Walkable || No collision
|-
| $01 || Solid || Blocks movement
|-
| $02 || Water || Requires swim (mermaid form)
|-
| $03 || Pit || Fall damage
|-
| $04 || Lava || Fire damage
|-
| $05 || Ice || Reduced friction
|-
| $06 || Slow || Reduced speed
|-
| $07 || Damage || Hurts on contact
|-
| $08 || Warp || Triggers area transition
|-
| $09 || Event || Triggers event flag
|-
| $0A || Hidden || Invisible solid (walls)
|-
| $0B || One-way || Directional passage
|-
| $0C-$0F || Reserved || Special cases
|}

===Collision Map Format===
Each map tile has a 4-bit collision value:
<pre>
Collision data is packed, 2 tiles per byte
Low nibble: Even tile column
High nibble: Odd tile column
</pre>

==Random Number Generator==

Soul Blazer uses a 16-bit LFSR (Linear Feedback Shift Register):
<pre>
Location: $7E0042-$7E0043

Seed on power-up: $0001

Update algorithm:
  bit = (rng ^ (rng >> 1) ^ (rng >> 3) ^ (rng >> 12)) & 1
  rng = (rng >> 1) | (bit << 15)
  
Returns: Low byte of rng
</pre>

==Timing==

===Frame Timing (NTSC)===
{| class="wikitable"
! Property !! Value
|-
| Frame rate || 60.0988 Hz
|-
| Scanlines per frame || 262
|-
| Dots per scanline || 341
|-
| VBlank duration || ~2.5 ms (scanlines 225-261)
|-
| CPU cycles per frame || ~59,646
|}

===Game Timing===
{| class="wikitable"
! Event !! Frames !! Seconds
|-
| Attack animation || 12 || 0.2
|-
| Magic cast || 18 || 0.3
|-
| Invincibility frames || 60 || 1.0
|-
| Text scroll delay || 4 || 0.067
|-
| Soul release animation || 90 || 1.5
|}

==Debug Features==

===Debug Mode Activation===
Game Genie codes to enable debug features:
{| class="wikitable"
! Code !! Effect
|-
| AAAA-AAAA || Enable debug menu (Start+Select)
|-
| BBBB-BBBB || Level select
|-
| CCCC-CCCC || All items
|-
| DDDD-DDDD || Invincibility
|}

===Debug RAM Addresses===
{| class="wikitable"
! Address !! Description
|-
| $7E1FE0 || Debug mode flags
|-
| $7E1FE1 || Frame advance enable
|-
| $7E1FE2 || Hitbox display
|-
| $7E1FE3 || Collision overlay
|}

==See Also==
* [[Soul Blazer:ROM map|ROM Map]]
* [[Soul Blazer:RAM map|RAM Map]]
* [[Soul Blazer:Data structures|Data Structures]]
* [[Soul Blazer:Audio|Audio System]]

[[Category:Soul Blazer]]
[[Category:Technical Reference]]
[[Category:SNES Documentation]]

<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:vm="using:GameInfoTools.UI.ViewModels"
			 xmlns:controls="using:GameInfoTools.UI.Controls"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
			 x:Class="GameInfoTools.UI.Views.MapEditorView"
			 x:DataType="vm:MapEditorViewModel">

	<Design.DataContext>
		<vm:MapEditorViewModel/>
	</Design.DataContext>

	<Grid RowDefinitions="Auto,*,Auto">
		<!-- Toolbar -->
		<StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Margin="16,16,16,8">
			<TextBlock Text="Offset:" VerticalAlignment="Center"/>
			<NumericUpDown Value="{Binding MapDataOffset}" Minimum="0" Maximum="16777215" Width="100" FormatString="X6"/>
			<TextBlock Text="Width:" VerticalAlignment="Center"/>
			<NumericUpDown Value="{Binding MapWidth}" Minimum="1" Maximum="256" Width="70"/>
			<TextBlock Text="Height:" VerticalAlignment="Center"/>
			<NumericUpDown Value="{Binding MapHeight}" Minimum="1" Maximum="256" Width="70"/>
			<Separator/>
			<Button Content="Load" Command="{Binding LoadMapCommand}" ToolTip.Tip="Load map from ROM"/>
			<Separator/>
			<TextBlock Text="Zoom:" VerticalAlignment="Center"/>
			<Button Content="-" Command="{Binding ZoomOutCommand}" Width="30"/>
			<TextBlock Text="{Binding Zoom, StringFormat={}{0}x}" VerticalAlignment="Center" Width="30" TextAlignment="Center"/>
			<Button Content="+" Command="{Binding ZoomInCommand}" Width="30"/>
			<Separator/>
			<CheckBox Content="Grid" IsChecked="{Binding ShowGrid}" VerticalAlignment="Center"/>
			<CheckBox Content="Numbers" IsChecked="{Binding ShowTileNumbers}" VerticalAlignment="Center"/>
			<Separator/>
			<Button Content="Undo" Command="{Binding UndoCommand}" IsEnabled="{Binding CanUndo}" ToolTip.Tip="{Binding UndoDescription}"/>
			<Button Content="Redo" Command="{Binding RedoCommand}" IsEnabled="{Binding CanRedo}" ToolTip.Tip="{Binding RedoDescription}"/>
			<Separator/>
			<Button Content="Export..." Command="{Binding ExportMapCommand}" CommandParameter="{Binding $parent[Window]}" ToolTip.Tip="Export map to file"/>
		</StackPanel>

		<!-- Main Content -->
		<Grid Grid.Row="1" ColumnDefinitions="*,220" Margin="16,8">
			<!-- Map View -->
			<Border Grid.Column="0" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
					CornerRadius="4" Padding="8" Margin="0,0,8,0">
				<DockPanel>
					<StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
						<TextBlock Text="{Binding MapName, FallbackValue=Map View}" FontWeight="SemiBold"/>
						<Button Content="◀" Command="{Binding PreviousMapCommand}" ToolTip.Tip="Previous Map"/>
						<TextBlock Text="{Binding MapIndex, StringFormat=Map {0}}" VerticalAlignment="Center"/>
						<Button Content="▶" Command="{Binding NextMapCommand}" ToolTip.Tip="Next Map"/>
					</StackPanel>
					<ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
						<!-- Visual Map Canvas using custom control -->
						<controls:MapCanvas
							x:Name="MapCanvasControl"
							MapData="{Binding MapDataArray}"
							MapWidth="{Binding MapWidth}"
							MapHeight="{Binding MapHeight}"
							TileSize="{Binding Zoom, Converter={x:Static controls:MapCanvas.ZoomToTileSizeConverter}}"
							ShowGrid="{Binding ShowGrid}"
							ShowTileNumbers="{Binding ShowTileNumbers}"
							SelectedX="{Binding SelectedX, Mode=TwoWay}"
							SelectedY="{Binding SelectedY, Mode=TwoWay}"/>
					</ScrollViewer>
				</DockPanel>
			</Border>

			<!-- Tile Palette and Settings -->
			<Border Grid.Column="1" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
					CornerRadius="4" Padding="16">
				<ScrollViewer>
					<StackPanel Spacing="16">
						<TextBlock Text="Map Settings" FontWeight="SemiBold" FontSize="16"/>

						<StackPanel Spacing="4">
							<TextBlock Text="Format:"/>
							<ComboBox ItemsSource="{Binding MapFormats}" SelectedItem="{Binding SelectedFormat}"/>
						</StackPanel>

						<Separator/>

						<TextBlock Text="Tile Palette" FontWeight="SemiBold"/>

						<StackPanel Spacing="4">
							<TextBlock Text="Selected Tile:"/>
							<NumericUpDown Value="{Binding SelectedTile}" Minimum="0" Maximum="255" FormatString="X2"/>
						</StackPanel>

						<StackPanel Orientation="Horizontal" Spacing="8">
							<Button Content="Set Tile" Command="{Binding SetTileCommand}" ToolTip.Tip="Set selected map tile"/>
							<Button Content="Fill" Command="{Binding FillCommand}" ToolTip.Tip="Fill entire map with selected tile"/>
						</StackPanel>

						<Separator/>

						<StackPanel Spacing="4">
							<TextBlock Text="Selected Tile Info" FontWeight="SemiBold"/>
							<TextBlock Text="{Binding SelectedX, StringFormat=X: {0}}" Opacity="0.7"/>
							<TextBlock Text="{Binding SelectedY, StringFormat=Y: {0}}" Opacity="0.7"/>
							<TextBlock Text="{Binding SelectedMapTile.TileIndex, StringFormat=Tile: 0x{0:X2}, FallbackValue=Tile: -}" Opacity="0.7"/>
							<TextBlock Text="{Binding SelectedMapTile.Offset, StringFormat=Offset: 0x{0:X6}, FallbackValue=Offset: -}" Opacity="0.7"/>
						</StackPanel>
					</StackPanel>
				</ScrollViewer>
			</Border>
		</Grid>

		<!-- Status Bar -->
		<Border Grid.Row="2" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" Padding="16,8">
			<Grid ColumnDefinitions="*,Auto">
				<TextBlock Grid.Column="0" Text="{Binding StatusText}"/>
				<TextBlock Grid.Column="1" Text="{Binding MapTiles.Count, StringFormat={}{0} tiles}"/>
			</Grid>
		</Border>
	</Grid>
</UserControl>

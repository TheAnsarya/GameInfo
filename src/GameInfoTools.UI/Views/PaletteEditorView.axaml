<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:vm="using:GameInfoTools.UI.ViewModels"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
			 x:Class="GameInfoTools.UI.Views.PaletteEditorView"
			 x:DataType="vm:PaletteEditorViewModel">

	<Design.DataContext>
		<vm:PaletteEditorViewModel/>
	</Design.DataContext>

	<Grid RowDefinitions="Auto,*,Auto" Margin="16">
		<!-- Toolbar -->
		<StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
			<TextBlock Text="Format:" VerticalAlignment="Center"/>
			<ComboBox ItemsSource="{Binding AvailableFormats}" SelectedItem="{Binding SelectedFormat}" Width="100"/>
			<TextBlock Text="Colors:" VerticalAlignment="Center"/>
			<ComboBox ItemsSource="{Binding CommonColorCounts}" SelectedItem="{Binding ColorCount}" Width="70"/>
			<Separator/>
			<TextBlock Text="ROM Offset:" VerticalAlignment="Center"/>
			<NumericUpDown Value="{Binding RomOffset}" Minimum="0" Maximum="16777215"
						   FormatString="X6" Width="100" FontFamily="Consolas"/>
			<Button Content="ðŸ“– Read" Command="{Binding ReadFromRomCommand}" ToolTip.Tip="Read from ROM"/>
			<Button Content="ðŸ’¾ Write" Command="{Binding WriteToRomCommand}" ToolTip.Tip="Write to ROM"/>
			<Separator/>
			<Button Content="ðŸ“¤ Export PNG" Command="{Binding ExportPngCommand}"
					CommandParameter="{Binding $parent[Window]}"/>
			<Button Content="ðŸ“¥ Import Image" Command="{Binding ImportFromImageCommand}"
					CommandParameter="{Binding $parent[Window]}"/>
		</StackPanel>

		<!-- Main Content -->
		<Grid Grid.Row="1" ColumnDefinitions="*,Auto,300">
			<!-- Color Grid -->
			<Border Grid.Column="0" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
					CornerRadius="4" Padding="8" Margin="0,0,8,0">
				<DockPanel>
					<Grid DockPanel.Dock="Top" ColumnDefinitions="*,Auto" Margin="0,0,0,8">
						<StackPanel Orientation="Horizontal" Spacing="8">
							<TextBlock Text="Palette:" FontWeight="SemiBold" VerticalAlignment="Center"/>
							<TextBox Text="{Binding PaletteName}" Width="150"/>
						</StackPanel>
						<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
							<TextBlock Text="{Binding UniqueColorCount, StringFormat='Unique: {0}'}"
									   VerticalAlignment="Center" Opacity="0.8"/>
							<TextBlock Text="Grayscale" IsVisible="{Binding IsGrayscale}"
									   VerticalAlignment="Center" Opacity="0.6"/>
						</StackPanel>
					</Grid>

					<!-- Color Swatch Grid -->
					<ItemsControl ItemsSource="{Binding Colors}">
						<ItemsControl.ItemsPanel>
							<ItemsPanelTemplate>
								<WrapPanel/>
							</ItemsPanelTemplate>
						</ItemsControl.ItemsPanel>
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<Border Width="48" Height="48" Margin="2" CornerRadius="4"
										BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
										BorderThickness="1" Cursor="Hand"
										Background="{Binding HexValue}">
									<ToolTip.Tip>
										<StackPanel>
											<TextBlock Text="{Binding Index, StringFormat='Index: {0}'}"/>
											<TextBlock Text="{Binding HexValue}"/>
											<TextBlock Text="{Binding RgbValue}"/>
										</StackPanel>
									</ToolTip.Tip>
								</Border>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</DockPanel>
			</Border>

			<GridSplitter Grid.Column="1" Width="4" ResizeDirection="Columns"/>

			<!-- Right Panel -->
			<Grid Grid.Column="2" RowDefinitions="Auto,*,Auto">
				<!-- Presets -->
				<Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
						CornerRadius="4" Padding="12" Margin="0,0,0,8">
					<StackPanel Spacing="8">
						<TextBlock Text="Presets" FontWeight="SemiBold"/>
						<WrapPanel Orientation="Horizontal">
							<Button Content="Grayscale" Command="{Binding CreateGrayscalePaletteCommand}"
									Margin="0,0,4,4"/>
							<Button Content="Game Boy" Command="{Binding CreateGameBoyPaletteCommand}"
									Margin="0,0,4,4"/>
						</WrapPanel>
					</StackPanel>
				</Border>

				<!-- Saved Palettes -->
				<Border Grid.Row="1" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
						CornerRadius="4" Padding="8">
					<DockPanel>
						<StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
							<TextBlock Text="Saved Palettes" FontWeight="SemiBold" VerticalAlignment="Center"/>
							<Button Content="ðŸ’¾" Command="{Binding SavePaletteCommand}" ToolTip.Tip="Save Current"/>
						</StackPanel>
						<ListBox ItemsSource="{Binding SavedPalettes}">
							<ListBox.ItemTemplate>
								<DataTemplate>
									<StackPanel Orientation="Horizontal" Spacing="8">
										<TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
										<TextBlock Text="{Binding Count, StringFormat='({0} colors)'}"
												   Opacity="0.6" VerticalAlignment="Center"/>
									</StackPanel>
								</DataTemplate>
							</ListBox.ItemTemplate>
						</ListBox>
					</DockPanel>
				</Border>

				<!-- Color Editor -->
				<Border Grid.Row="2" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
						CornerRadius="4" Padding="12" Margin="0,8,0,0">
					<StackPanel Spacing="8">
						<TextBlock Text="Edit Color" FontWeight="SemiBold"/>
						<TextBlock Text="{Binding SelectedColorIndex, StringFormat='Selected: {0}'}"
								   IsVisible="{Binding SelectedColorIndex, Converter={x:Static ObjectConverters.IsNotNull}}"/>
						<TextBlock Text="Click a color to select" Opacity="0.6"
								   IsVisible="{Binding !SelectedColorIndex}"/>
					</StackPanel>
				</Border>
			</Grid>
		</Grid>

		<!-- Status Bar -->
		<Border Grid.Row="2" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
				CornerRadius="4" Padding="8" Margin="0,8,0,0">
			<TextBlock Text="{Binding StatusText}" Opacity="0.8"/>
		</Border>
	</Grid>
</UserControl>

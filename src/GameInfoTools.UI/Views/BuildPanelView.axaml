<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:vm="using:GameInfoTools.Core.Project.ViewModels"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="300"
			 x:Class="GameInfoTools.UI.Views.BuildPanelView"
			 x:DataType="vm:BuildPanelViewModel">

	<Design.DataContext>
		<vm:BuildPanelViewModel/>
	</Design.DataContext>

	<Grid RowDefinitions="Auto,*,Auto">
		<!-- Toolbar -->
		<Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}" Padding="8">
			<Grid ColumnDefinitions="Auto,Auto,Auto,Auto,*,Auto,Auto">
				<!-- Build Controls -->
				<Button Grid.Column="0" Content="ðŸ”¨ Build" Command="{Binding BuildCommand}"
						IsEnabled="{Binding CanBuild}" IsVisible="{Binding !IsBuilding}"
						Padding="12,6" Margin="0,0,4,0"/>
				<Button Grid.Column="0" Content="â³ Building..." IsEnabled="False"
						IsVisible="{Binding IsBuilding}" Padding="12,6" Margin="0,0,4,0"/>

				<Button Grid.Column="1" Content="ðŸ”„ Rebuild" Command="{Binding RebuildCommand}"
						IsEnabled="{Binding CanBuild}" Padding="8,6" Margin="0,0,4,0"/>
				<Button Grid.Column="2" Content="ðŸ§¹ Clean" Command="{Binding CleanCommand}"
						Padding="8,6" Margin="0,0,8,0"/>

				<!-- Profile Selection -->
				<StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
					<TextBlock Text="Profile:" VerticalAlignment="Center" Opacity="0.7"/>
					<ComboBox ItemsSource="{Binding Profiles}" SelectedItem="{Binding SelectedProfile}"
							  Width="120" Padding="6,4"/>
				</StackPanel>

				<!-- Auto-verify Toggle -->
				<CheckBox Grid.Column="5" Content="Auto-verify" IsChecked="{Binding AutoVerify}"
						  VerticalAlignment="Center" Margin="0,0,8,0"/>

				<!-- Build Status -->
				<Border Grid.Column="6" Padding="8,4" CornerRadius="4"
						Background="{DynamicResource SystemControlBackgroundBaseLowBrush}">
					<StackPanel Orientation="Horizontal" Spacing="8">
						<Ellipse Width="10" Height="10" VerticalAlignment="Center">
							<Ellipse.Fill>
								<SolidColorBrush Color="{Binding LastBuildStatusColor}"/>
							</Ellipse.Fill>
						</Ellipse>
						<TextBlock Text="{Binding LastBuildStatusText}" VerticalAlignment="Center"/>
						<TextBlock Text="{Binding LastBuildTime}" Opacity="0.5" FontSize="11"
								   VerticalAlignment="Center" IsVisible="{Binding LastBuildTime, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
					</StackPanel>
				</Border>
			</Grid>
		</Border>

		<!-- Output Panel -->
		<TabControl Grid.Row="1" Margin="8,4">
			<!-- Output Tab -->
			<TabItem Header="Output">
				<Border Background="{DynamicResource SystemControlBackgroundChromeLowBrush}"
						CornerRadius="4" Padding="4">
					<ScrollViewer HorizontalScrollBarVisibility="Auto">
						<ItemsControl ItemsSource="{Binding Output}">
							<ItemsControl.ItemTemplate>
								<DataTemplate>
									<StackPanel Orientation="Horizontal" Spacing="8">
										<TextBlock Text="{Binding Timestamp}" Opacity="0.5" FontSize="11"
												   FontFamily="Consolas, Courier New, monospace"/>
										<TextBlock Text="{Binding Message}"
												   FontFamily="Consolas, Courier New, monospace"
												   Foreground="{Binding Color}"/>
									</StackPanel>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</ScrollViewer>
				</Border>
			</TabItem>

			<!-- Errors Tab -->
			<TabItem>
				<TabItem.Header>
					<StackPanel Orientation="Horizontal" Spacing="4">
						<TextBlock Text="Errors"/>
						<Border Background="Red" CornerRadius="8" Padding="6,2"
								IsVisible="{Binding Errors.Count}">
							<TextBlock Text="{Binding Errors.Count}" FontSize="10" Foreground="White"/>
						</Border>
					</StackPanel>
				</TabItem.Header>
				<Border Background="{DynamicResource SystemControlBackgroundChromeLowBrush}"
						CornerRadius="4" Padding="4">
					<DataGrid ItemsSource="{Binding Errors}" AutoGenerateColumns="False"
							  IsReadOnly="True" GridLinesVisibility="Horizontal">
						<DataGrid.Columns>
							<DataGridTextColumn Header="Location" Binding="{Binding Location}" Width="200"/>
							<DataGridTextColumn Header="Message" Binding="{Binding Text}" Width="*"/>
						</DataGrid.Columns>
					</DataGrid>
				</Border>
			</TabItem>

			<!-- Warnings Tab -->
			<TabItem>
				<TabItem.Header>
					<StackPanel Orientation="Horizontal" Spacing="4">
						<TextBlock Text="Warnings"/>
						<Border Background="Orange" CornerRadius="8" Padding="6,2"
								IsVisible="{Binding Warnings.Count}">
							<TextBlock Text="{Binding Warnings.Count}" FontSize="10" Foreground="White"/>
						</Border>
					</StackPanel>
				</TabItem.Header>
				<Border Background="{DynamicResource SystemControlBackgroundChromeLowBrush}"
						CornerRadius="4" Padding="4">
					<DataGrid ItemsSource="{Binding Warnings}" AutoGenerateColumns="False"
							  IsReadOnly="True" GridLinesVisibility="Horizontal">
						<DataGrid.Columns>
							<DataGridTextColumn Header="Location" Binding="{Binding Location}" Width="200"/>
							<DataGridTextColumn Header="Message" Binding="{Binding Text}" Width="*"/>
						</DataGrid.Columns>
					</DataGrid>
				</Border>
			</TabItem>
		</TabControl>

		<!-- Progress Bar (when building) -->
		<Border Grid.Row="2" Padding="8" IsVisible="{Binding IsBuilding}">
			<StackPanel Spacing="4">
				<ProgressBar Value="{Binding Progress}" Maximum="100"/>
				<TextBlock Text="{Binding ProgressMessage}" FontSize="11" Opacity="0.7"/>
			</StackPanel>
		</Border>
	</Grid>
</UserControl>

<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 xmlns:vm="using:GameInfoTools.UI.ViewModels"
			 mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="700"
			 x:Class="GameInfoTools.UI.Views.DataCrystalView"
			 x:DataType="vm:DataCrystalViewModel">

	<DockPanel>
		<!-- AI Warning Banner -->
		<Border DockPanel.Dock="Top" Background="#FF5722" Padding="12"
				IsVisible="{Binding ShowAiWarning}">
			<DockPanel>
				<Button DockPanel.Dock="Right" Content="‚úï" Command="{Binding DismissWarningCommand}"
						Background="Transparent" Foreground="White" Padding="8,4"/>
				<StackPanel>
					<TextBlock Text="‚ö†Ô∏è AI-GENERATED CONTENT WARNING" FontWeight="Bold" Foreground="White" FontSize="14"/>
					<TextBlock Text="{Binding AiWarningMessage}" Foreground="White" TextWrapping="Wrap" FontSize="12" Margin="0,4,0,0"/>
				</StackPanel>
			</DockPanel>
		</Border>

		<!-- Toolbar -->
		<Border DockPanel.Dock="Top" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
				Padding="8">
			<StackPanel Orientation="Horizontal" Spacing="8">
				<TextBlock Text="üìö Data Crystal" FontWeight="Bold" VerticalAlignment="Center" FontSize="14"/>
				<Separator/>

				<!-- Connection Status -->
				<TextBlock Text="{Binding StatusText}" VerticalAlignment="Center" Opacity="0.8"/>

				<Separator/>

				<!-- Directory Selection -->
				<Button Content="üìÅ Select Folder" Command="{Binding SelectDirectoryCommand}"
						CommandParameter="{Binding $parent[Window]}"
						ToolTip.Tip="Select wiki files directory"/>
				<Button Content="üîÑ Refresh" Command="{Binding RefreshFileListCommand}"
						ToolTip.Tip="Refresh file list"/>
				<Button Content="üìä Check Status" Command="{Binding CheckAllStatusCommand}"
						ToolTip.Tip="Check sync status for all files"/>
			</StackPanel>
		</Border>

		<!-- Main Content -->
		<Grid ColumnDefinitions="300,*" Margin="8">
			<!-- Left Panel: File List -->
			<Border Grid.Column="0" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
					CornerRadius="4" Padding="8" Margin="0,0,8,0">
				<DockPanel>
					<TextBlock DockPanel.Dock="Top" Text="üìÑ Wiki Files" FontWeight="SemiBold" Margin="0,0,0,8"/>

					<ListBox ItemsSource="{Binding SyncItems}" SelectedItem="{Binding SelectedItem}">
						<ListBox.ItemTemplate>
							<DataTemplate x:DataType="vm:WikiSyncItem">
								<Grid ColumnDefinitions="Auto,*,Auto,Auto" Margin="4">
									<TextBlock Grid.Column="0" Text="{Binding StatusIcon}" Width="24" FontSize="14"/>
									<StackPanel Grid.Column="1">
										<TextBlock Text="{Binding WikiTitle}" FontWeight="SemiBold" FontSize="12"/>
										<TextBlock Text="{Binding StatusText}" FontSize="10" Opacity="0.7"/>
									</StackPanel>
									<TextBlock Grid.Column="2" Text="{Binding ReviewIcon}" Width="24" FontSize="14"
											   ToolTip.Tip="Review status"/>
								</Grid>
							</DataTemplate>
						</ListBox.ItemTemplate>
					</ListBox>
				</DockPanel>
			</Border>

			<!-- Right Panel: Details & Actions -->
			<TabControl Grid.Column="1">
				<!-- Login Tab -->
				<TabItem Header="üîë Login">
					<StackPanel Spacing="12" Margin="16">
						<TextBlock Text="Data Crystal Login" FontWeight="Bold" FontSize="16"/>
						<TextBlock Text="Use a bot password for authentication. Never use your main password!"
								   TextWrapping="Wrap" Opacity="0.8"/>

						<Grid ColumnDefinitions="120,*" RowDefinitions="Auto,Auto,Auto" Margin="0,12,0,0">
							<TextBlock Grid.Row="0" Grid.Column="0" Text="Username:" VerticalAlignment="Center"/>
							<TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Username}" Watermark="Your wiki username"/>

							<TextBlock Grid.Row="1" Grid.Column="0" Text="Bot Password:" VerticalAlignment="Center" Margin="0,8,0,0"/>
							<TextBox Grid.Row="1" Grid.Column="1" Text="{Binding BotPassword}"
									 PasswordChar="‚Ä¢" Watermark="Bot password from Special:BotPasswords" Margin="0,8,0,0"/>
						</Grid>

						<StackPanel Orientation="Horizontal" Spacing="8" Margin="0,16,0,0">
							<Button Content="üîì Login" Command="{Binding LoginCommand}"
									IsEnabled="{Binding !IsLoggedIn}"/>
							<Button Content="üîí Logout" Command="{Binding LogoutCommand}"
									IsEnabled="{Binding IsLoggedIn}"/>
						</StackPanel>

						<TextBlock Text="Status:" FontWeight="SemiBold" Margin="0,16,0,0"/>
						<TextBlock Text="{Binding StatusText}"/>

						<TextBlock Text="Note: You can pull/compare pages without logging in. Login is only required for pushing changes."
								   TextWrapping="Wrap" Opacity="0.6" FontSize="11" Margin="0,16,0,0"/>
					</StackPanel>
				</TabItem>

				<!-- Sync Tab -->
				<TabItem Header="üîÑ Sync">
					<DockPanel>
						<Border DockPanel.Dock="Top" Padding="8" Background="{DynamicResource SystemControlBackgroundBaseLowBrush}">
							<Grid ColumnDefinitions="*,Auto">
								<StackPanel Grid.Column="0">
									<TextBlock Text="{Binding SelectedItem.WikiTitle, FallbackValue='(Select a file)'}" FontWeight="Bold"/>
									<TextBlock Text="{Binding SelectedItem.StatusText, FallbackValue=''}" FontSize="11" Opacity="0.7"/>
								</StackPanel>
								<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4">
									<Button Content="‚¨áÔ∏è Pull" Command="{Binding PullChangesCommand}"
											ToolTip.Tip="Download page from Data Crystal"/>
									<Button Content="üîç Compare" Command="{Binding CompareWithRemoteCommand}"
											ToolTip.Tip="Compare local with remote"/>
									<Button Content="‚¨ÜÔ∏è Push" Command="{Binding PushChangesCommand}"
											IsEnabled="{Binding SelectedItem.CanUpload}"
											ToolTip.Tip="Upload to Data Crystal (requires review)"/>
								</StackPanel>
							</Grid>
						</Border>

						<Grid RowDefinitions="*,Auto">
							<!-- Diff View -->
							<TextBox Grid.Row="0" Text="{Binding DiffText}" IsReadOnly="True"
									 FontFamily="Consolas" FontSize="11"
									 AcceptsReturn="True" TextWrapping="NoWrap"/>

							<!-- Review Section -->
							<Border Grid.Row="1" Padding="8" Background="{DynamicResource SystemControlBackgroundBaseLowBrush}">
								<StackPanel Spacing="8">
									<TextBlock Text="üìã Review for Upload" FontWeight="Bold"/>
									<TextBlock Text="Mark content as reviewed ONLY after manual verification!"
											   Foreground="Orange" FontSize="11"/>

									<Grid ColumnDefinitions="Auto,*,Auto" Margin="0,8,0,0">
										<TextBlock Grid.Column="0" Text="Reviewer:" VerticalAlignment="Center"/>
										<TextBox Grid.Column="1" Text="{Binding ReviewerName}"
												 Watermark="Your name" Margin="8,0"/>
										<StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4">
											<Button Content="‚úÖ Mark Reviewed" Command="{Binding MarkAsReviewedCommand}"/>
											<Button Content="üîÑ Clear Review" Command="{Binding ClearReviewCommand}"/>
										</StackPanel>
									</Grid>

									<TextBox Text="{Binding ReviewNotes}" Watermark="Review notes (optional)"
											 AcceptsReturn="True" Height="50"/>
								</StackPanel>
							</Border>
						</Grid>
					</DockPanel>
				</TabItem>

				<!-- Browse Tab -->
				<TabItem Header="üîé Browse">
					<DockPanel>
						<StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Spacing="8" Margin="8">
							<TextBox Text="{Binding CurrentPage}" Watermark="Page title" Width="300"/>
							<Button Content="üîç Fetch" Command="{Binding FetchPageCommand}"/>
						</StackPanel>

						<TextBox Text="{Binding PageContent}" IsReadOnly="True"
								 FontFamily="Consolas" FontSize="11"
								 AcceptsReturn="True" TextWrapping="NoWrap" Margin="8"/>
					</DockPanel>
				</TabItem>

				<!-- Help Tab -->
				<TabItem Header="‚ùì Help">
					<ScrollViewer Margin="16">
						<StackPanel Spacing="16">
							<TextBlock Text="Data Crystal Integration Help" FontWeight="Bold" FontSize="18"/>

							<StackPanel Spacing="4">
								<TextBlock Text="‚ö†Ô∏è AI Content Policy" FontWeight="Bold" Foreground="Orange"/>
								<TextBlock TextWrapping="Wrap">
									Data Crystal strictly forbids AI-generated content. All content created using
									GameInfoTools or any AI assistance MUST be manually reviewed and edited by a
									human before uploading. Violations will result in a permanent ban from Data Crystal.
								</TextBlock>
							</StackPanel>

							<StackPanel Spacing="4">
								<TextBlock Text="üîÑ Workflow" FontWeight="Bold"/>
								<TextBlock TextWrapping="Wrap">
									1. Generate wiki content using the Wiki Editor tool
									2. Save the .wikitext file to your wiki directory
									3. MANUALLY review and edit ALL content
									4. Mark the file as "Reviewed" with your name
									5. Use "Push" to upload to Data Crystal
								</TextBlock>
							</StackPanel>

							<StackPanel Spacing="4">
								<TextBlock Text="üîë Authentication" FontWeight="Bold"/>
								<TextBlock TextWrapping="Wrap">
									Create a bot password at Special:BotPasswords on Data Crystal.
									Never use your main wiki password. Bot passwords allow controlled
									API access with specific permissions.
								</TextBlock>
							</StackPanel>

							<StackPanel Spacing="4">
								<TextBlock Text="üìä Status Icons" FontWeight="Bold"/>
								<TextBlock TextWrapping="Wrap">
									‚úì In Sync - Local matches remote
									üìÑ Local Only - Not on wiki yet
									‚òÅÔ∏è Remote Only - On wiki, not saved locally
									üìù Local Modified - Local changes not uploaded
									‚¨áÔ∏è Remote Modified - Wiki has newer version
									‚ö†Ô∏è Conflict - Both local and remote changed
								</TextBlock>
							</StackPanel>

							<StackPanel Spacing="4">
								<TextBlock Text="‚úÖ Review Status" FontWeight="Bold"/>
								<TextBlock TextWrapping="Wrap">
									‚úÖ Reviewed - Ready for upload
									‚õî Not Reviewed - Cannot upload until reviewed
								</TextBlock>
							</StackPanel>

							<StackPanel Spacing="4">
								<TextBlock Text="üìù Change Markers" FontWeight="Bold"/>
								<TextBlock TextWrapping="Wrap">
									The tool adds HTML comment markers to track content origin:
									- @CHANGE:AiGenerated - AI-generated content (requires review)
									- @CHANGE:Imported - Pulled from wiki
									- @CHANGE:Modified - Human modifications
									- @REVIEWED - Marked as reviewed
									These are stripped when uploading.
								</TextBlock>
							</StackPanel>
						</StackPanel>
					</ScrollViewer>
				</TabItem>
			</TabControl>
		</Grid>

		<!-- Loading Overlay -->
		<Border IsVisible="{Binding IsBusy}" Background="#80000000"
				HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
			<StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
				<ProgressBar IsIndeterminate="True" Width="200"/>
				<TextBlock Text="{Binding StatusText}" Foreground="White" Margin="0,8,0,0"/>
			</StackPanel>
		</Border>
	</DockPanel>
</UserControl>

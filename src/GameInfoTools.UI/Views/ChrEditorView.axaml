<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:vm="using:GameInfoTools.UI.ViewModels"
			 xmlns:controls="using:GameInfoTools.UI.Controls"
			 xmlns:local="using:GameInfoTools.UI.Converters"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="700"
			 x:Class="GameInfoTools.UI.Views.ChrEditorView"
			 x:DataType="vm:ChrEditorViewModel">

	<Design.DataContext>
		<vm:ChrEditorViewModel/>
	</Design.DataContext>

	<Grid RowDefinitions="Auto,*,Auto">
		<!-- Toolbar -->
		<StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Margin="16,16,16,8">
			<TextBlock Text="CHR Offset:" VerticalAlignment="Center"/>
			<NumericUpDown Value="{Binding ChrOffset}" Minimum="0" Maximum="16777215" Width="120" FormatString="X6"/>
			<Separator/>
			<TextBlock Text="Format:" VerticalAlignment="Center"/>
			<ComboBox ItemsSource="{Binding AvailableFormats}" SelectedItem="{Binding TileFormat}" Width="120"/>
			<Separator/>
			<TextBlock Text="Zoom:" VerticalAlignment="Center"/>
			<Button Content="-" Command="{Binding ZoomOutCommand}" Width="30"/>
			<TextBlock Text="{Binding Zoom, StringFormat={}{0}x}" VerticalAlignment="Center" Width="30" TextAlignment="Center"/>
			<Button Content="+" Command="{Binding ZoomInCommand}" Width="30"/>
			<Separator/>
			<CheckBox Content="Grid" IsChecked="{Binding ShowGrid}" VerticalAlignment="Center"/>
			<Button Content="âŠž" Command="{Binding CycleGridOverlayCommand}" ToolTip.Tip="Cycle grid overlay (8Ã—8/16Ã—16)" Width="28"/>
			<Separator/>
			<TextBlock Text="Palette:" VerticalAlignment="Center"/>
			<ComboBox x:Name="PaletteComboBox"
					  ItemsSource="{Binding PalettePresets}"
					  SelectedIndex="{Binding SelectedPaletteIndex}"
					  Width="130"
					  SelectionChanged="PaletteComboBox_SelectionChanged">
				<ComboBox.ItemTemplate>
					<DataTemplate DataType="vm:PalettePreset">
						<TextBlock Text="{Binding Name}"/>
					</DataTemplate>
				</ComboBox.ItemTemplate>
			</ComboBox>
			<Separator/>
			<Button Content="Export..." Command="{Binding ExportTilesetCommand}" CommandParameter="{Binding $parent[Window]}" ToolTip.Tip="Export tileset to image"/>
			<Button Content="Import..." Command="{Binding ImportTilesetCommand}" CommandParameter="{Binding $parent[Window]}" ToolTip.Tip="Import tileset from image"/>
			<Button Content="Import+Match" Command="{Binding ImportWithPaletteMatchCommand}" CommandParameter="{Binding $parent[Window]}" ToolTip.Tip="Import with palette matching"/>
		</StackPanel>

		<!-- Main Content -->
		<Grid Grid.Row="1" ColumnDefinitions="*,280" Margin="16,8">
			<!-- Tile Grid -->
			<Border Grid.Column="0" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
					CornerRadius="4" Padding="8" Margin="0,0,8,0">
				<DockPanel>
					<StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
						<TextBlock Text="Tile Grid" FontWeight="SemiBold"/>
						<Button Content="â—€" Command="{Binding PreviousBankCommand}" ToolTip.Tip="Previous Bank"/>
						<TextBlock Text="{Binding SelectedBank, StringFormat=Bank {0}}" VerticalAlignment="Center"/>
						<Button Content="â–¶" Command="{Binding NextBankCommand}" ToolTip.Tip="Next Bank"/>
						<Separator/>
						<Button Content="â†©" Command="{Binding UndoCommand}" ToolTip.Tip="{Binding UndoDescription, StringFormat=Undo: {0}}" IsEnabled="{Binding CanUndo}" Width="30"/>
						<Button Content="â†ª" Command="{Binding RedoCommand}" ToolTip.Tip="{Binding RedoDescription, StringFormat=Redo: {0}}" IsEnabled="{Binding CanRedo}" Width="30"/>
						<ToggleButton Content="ðŸ“œ" IsChecked="{Binding ShowUndoHistory}" ToolTip.Tip="Show undo history" Width="30"/>
						<Separator/>
						<Button Content="ðŸ“‹" Command="{Binding CopyTileCommand}" ToolTip.Tip="Copy Tile" Width="30"/>
						<Button Content="ðŸ“„" Command="{Binding PasteTileCommand}" ToolTip.Tip="Paste Tile" Width="30" IsEnabled="{Binding HasClipboard}"/>
						<Button Content="ðŸ—‘" Command="{Binding ClearTileCommand}" ToolTip.Tip="Clear Tile" Width="30"/>
						<Separator/>
						<ToggleButton Content="âŠž" IsChecked="{Binding AllowMultiSelect}" ToolTip.Tip="Multi-select mode (Ctrl+Click)" Width="30"/>
						<ToggleButton Content="âš–" IsChecked="{Binding ShowComparisonView}" ToolTip.Tip="Compare with original" Width="30"/>
						<ToggleButton Content="ðŸ”" IsChecked="{Binding ShowTileSearch}" ToolTip.Tip="Tile search" Width="30"/>
						<Separator/>
						<Button Content="ðŸ’¾ CHR" Command="{Binding ExportSelectedTilesCommand}" CommandParameter="{Binding $parent[Window]}"
								ToolTip.Tip="Export selection to CHR" FontSize="10" Padding="4,2"/>
						<Button Content="ðŸ’¾ PNG" Command="{Binding ExportSelectedTilesToPngCommand}" CommandParameter="{Binding $parent[Window]}"
								ToolTip.Tip="Export selection to PNG" FontSize="10" Padding="4,2"/>
						<Separator/>
						<Button Content="ðŸ“‹ Wiki" Command="{Binding CopyAsWikitextCommand}"
								ToolTip.Tip="Copy tile data as wikitext" FontSize="10" Padding="4,2"/>
					</StackPanel>

					<!-- Multi-select toolbar (shown when multi-select is active) -->
					<StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Spacing="4" Margin="0,0,0,8"
								IsVisible="{Binding AllowMultiSelect}">
						<TextBlock Text="{Binding SelectedTileIndices.Count, StringFormat={}{0} selected}" FontSize="11" VerticalAlignment="Center" Opacity="0.7"/>
						<Separator/>
						<Button Content="â†”" Command="{Binding FlipSelectedTilesHorizontalCommand}" ToolTip.Tip="Flip selected horizontal" FontSize="10" Padding="4,2"/>
						<Button Content="â†•" Command="{Binding FlipSelectedTilesVerticalCommand}" ToolTip.Tip="Flip selected vertical" FontSize="10" Padding="4,2"/>
						<Button Content="â†»" Command="{Binding RotateSelectedTilesCommand}" ToolTip.Tip="Rotate selected 90Â°" FontSize="10" Padding="4,2"/>
						<Button Content="ðŸ—‘" Command="{Binding ClearSelectedTilesCommand}" ToolTip.Tip="Clear selected tiles" FontSize="10" Padding="4,2"/>
					</StackPanel>

					<Grid>
						<ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
							<!-- Visual Tile Grid using custom control -->
							<controls:TileGridCanvas
								x:Name="TileGrid"
								Tiles="{Binding TileGraphics}"
								TilesPerRow="16"
								Palette="{Binding CurrentPalette}"
								Scale="{Binding Zoom}"
								ShowGrid="{Binding ShowGrid}"
								SelectedTileIndex="{Binding SelectedTileIndex, Mode=TwoWay}"
								AllowMultiSelect="{Binding AllowMultiSelect}"
								GridOverlay="{Binding GridOverlayMode}"
								TileSpacing="1"/>
						</ScrollViewer>

						<!-- Tile Search Panel (overlay) -->
						<Border Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
								CornerRadius="4" Padding="8" Margin="8"
								HorizontalAlignment="Left" VerticalAlignment="Top"
								MaxWidth="220" MaxHeight="350"
								IsVisible="{Binding ShowTileSearch}">
							<DockPanel>
								<TextBlock DockPanel.Dock="Top" Text="ðŸ” Tile Search" FontWeight="SemiBold" FontSize="12" Margin="0,0,0,8"/>
								<StackPanel Spacing="4">
									<Button Content="Search Empty Tiles" Command="{Binding SearchEmptyTilesCommand}" HorizontalAlignment="Stretch" FontSize="11"/>
									<Button Content="Search Duplicates" Command="{Binding SearchDuplicateTilesCommand}" HorizontalAlignment="Stretch" FontSize="11"/>
									<Separator/>
									<TextBlock Text="Search by Color:" FontSize="10"/>
									<StackPanel Orientation="Horizontal" Spacing="4">
										<Button Content="0" Command="{Binding SearchByColorCommand}" CommandParameter="0" Width="24" FontSize="10"/>
										<Button Content="1" Command="{Binding SearchByColorCommand}" CommandParameter="1" Width="24" FontSize="10"/>
										<Button Content="2" Command="{Binding SearchByColorCommand}" CommandParameter="2" Width="24" FontSize="10"/>
										<Button Content="3" Command="{Binding SearchByColorCommand}" CommandParameter="3" Width="24" FontSize="10"/>
									</StackPanel>
									<Separator/>
									<TextBlock Text="Similar Tiles:" FontSize="10"/>
									<StackPanel Orientation="Horizontal" Spacing="4">
										<Slider Value="{Binding SearchSimilarityThreshold}" Minimum="50" Maximum="100" Width="100"/>
										<TextBlock Text="{Binding SearchSimilarityThreshold, StringFormat={}{0}%}" FontSize="10" VerticalAlignment="Center"/>
									</StackPanel>
									<Button Content="Find Similar" Command="{Binding SearchSimilarTilesCommand}" HorizontalAlignment="Stretch" FontSize="11"/>
									<Separator/>
									<TextBlock Text="{Binding TileSearchResults.Count, StringFormat={}{0} results}" FontSize="10" Opacity="0.7"/>
									<Button Content="Select All Results" Command="{Binding SelectSearchResultsCommand}"
											HorizontalAlignment="Stretch" FontSize="11"
											IsEnabled="{Binding TileSearchResults.Count}"/>
								</StackPanel>
							</DockPanel>
						</Border>

						<!-- Undo History Panel (overlay) -->
						<Border Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
								CornerRadius="4" Padding="8" Margin="8"
								HorizontalAlignment="Right" VerticalAlignment="Top"
								MaxWidth="200" MaxHeight="300"
								IsVisible="{Binding ShowUndoHistory}">
							<DockPanel>
								<TextBlock DockPanel.Dock="Top" Text="Undo History" FontWeight="SemiBold" FontSize="12" Margin="0,0,0,4"/>
								<ScrollViewer>
									<StackPanel Spacing="2">
										<TextBlock Text="Can Undo:" FontSize="10" Opacity="0.7"/>
										<ItemsControl ItemsSource="{Binding UndoHistoryList}">
											<ItemsControl.ItemTemplate>
												<DataTemplate>
													<TextBlock Text="{Binding}" FontSize="10" Padding="4,1" Background="{DynamicResource SystemControlBackgroundChromeLowBrush}" Margin="0,1"/>
												</DataTemplate>
											</ItemsControl.ItemTemplate>
										</ItemsControl>
										<TextBlock Text="Can Redo:" FontSize="10" Opacity="0.7" Margin="0,4,0,0"/>
										<ItemsControl ItemsSource="{Binding RedoHistoryList}">
											<ItemsControl.ItemTemplate>
												<DataTemplate>
													<TextBlock Text="{Binding}" FontSize="10" Padding="4,1" Background="{DynamicResource SystemControlBackgroundChromeLowBrush}" Margin="0,1" Opacity="0.6"/>
												</DataTemplate>
											</ItemsControl.ItemTemplate>
										</ItemsControl>
									</StackPanel>
								</ScrollViewer>
							</DockPanel>
						</Border>
					</Grid>
				</DockPanel>
			</Border>

			<!-- Right Panel - Tile Editor -->
			<Border Grid.Column="1" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
					CornerRadius="4" Padding="16">
				<ScrollViewer>
					<StackPanel Spacing="16">
						<TextBlock Text="Tile Editor" FontWeight="SemiBold" FontSize="16"/>

						<!-- Selected Tile Preview -->
						<StackPanel Spacing="8">
							<StackPanel Orientation="Horizontal" Spacing="8">
								<TextBlock Text="Selected Tile:" VerticalAlignment="Center"/>
								<TextBlock Text="{Binding SelectedTileIndex, StringFormat=Tile ${0:X2}}" FontWeight="SemiBold" VerticalAlignment="Center"/>
								<ToggleButton Content="âœï¸" IsChecked="{Binding IsPixelEditMode}"
											  ToolTip.Tip="Toggle pixel edit mode (click to draw)" Width="30"/>
							</StackPanel>

							<!-- Comparison View (side-by-side Original vs Current) -->
							<Grid ColumnDefinitions="Auto,8,Auto" IsVisible="{Binding ShowComparisonView}">
								<StackPanel Grid.Column="0" Spacing="4">
									<TextBlock Text="Original" FontSize="11" Opacity="0.7" HorizontalAlignment="Center"/>
									<Border Background="Black" CornerRadius="4" Padding="4">
										<controls:TileCanvas
											TileData="{Binding OriginalTileData}"
											Palette="{Binding CurrentPalette}"
											Scale="4"
											ShowGrid="False"/>
									</Border>
									<Button Content="Reset" Command="{Binding ResetToOriginalCommand}" FontSize="10" Padding="4,2" HorizontalAlignment="Center"/>
								</StackPanel>
								<StackPanel Grid.Column="2" Spacing="4">
									<TextBlock Text="Current" FontSize="11" Opacity="0.7" HorizontalAlignment="Center"/>
									<Border Background="Black" CornerRadius="4" Padding="4">
										<controls:TileCanvas
											TileData="{Binding SelectedTileData}"
											Palette="{Binding CurrentPalette}"
											Scale="4"
											ShowGrid="False"/>
									</Border>
									<Button Content="Set as Original" Command="{Binding SetOriginalAsCurrentCommand}" FontSize="10" Padding="4,2" HorizontalAlignment="Center"/>
								</StackPanel>
							</Grid>

							<!-- Large tile preview - switches between view-only and editable (hidden when comparison view is active) -->
							<Border Background="Black" CornerRadius="4" Padding="4" HorizontalAlignment="Left"
									IsVisible="{Binding !ShowComparisonView}">
								<Panel>
									<!-- View-only tile canvas (hidden when editing) -->
									<controls:TileCanvas
										TileData="{Binding SelectedTileData}"
										Palette="{Binding CurrentPalette}"
										Scale="8"
										ShowGrid="{Binding ShowGrid}"
										IsVisible="{Binding !IsPixelEditMode}"/>
									<!-- Editable tile canvas (shown when editing) -->
									<controls:EditableTileCanvas
										x:Name="PixelEditor"
										TileData="{Binding SelectedTileData}"
										Palette="{Binding CurrentPalette}"
										Scale="8"
										ShowGrid="{Binding ShowGrid}"
										SelectedColorIndex="{Binding SelectedColorIndex}"
										CurrentTool="{Binding CurrentDrawingTool}"
										IsVisible="{Binding IsPixelEditMode}"/>
								</Panel>
							</Border>

							<!-- Color picker when in edit mode -->
							<StackPanel Orientation="Horizontal" Spacing="4" IsVisible="{Binding IsPixelEditMode}">
								<TextBlock Text="Color:" VerticalAlignment="Center" FontSize="11"/>
								<RadioButton GroupName="ColorPicker" Content="0" IsChecked="{Binding SelectedColorIndex, Converter={x:Static local:IntEqualsConverter.Instance}, ConverterParameter=0}"
											 Width="24" Padding="4,2"/>
								<RadioButton GroupName="ColorPicker" Content="1" IsChecked="{Binding SelectedColorIndex, Converter={x:Static local:IntEqualsConverter.Instance}, ConverterParameter=1}"
											 Width="24" Padding="4,2"/>
								<RadioButton GroupName="ColorPicker" Content="2" IsChecked="{Binding SelectedColorIndex, Converter={x:Static local:IntEqualsConverter.Instance}, ConverterParameter=2}"
											 Width="24" Padding="4,2"/>
								<RadioButton GroupName="ColorPicker" Content="3" IsChecked="{Binding SelectedColorIndex, Converter={x:Static local:IntEqualsConverter.Instance}, ConverterParameter=3}"
											 Width="24" Padding="4,2"/>
							</StackPanel>

							<!-- Drawing tools when in edit mode -->
							<StackPanel Orientation="Horizontal" Spacing="4" IsVisible="{Binding IsPixelEditMode}">
								<TextBlock Text="Tool:" VerticalAlignment="Center" FontSize="11"/>
								<RadioButton GroupName="DrawingTool" Content="âœï¸" ToolTip.Tip="Pencil"
											 IsChecked="{Binding CurrentDrawingTool, Converter={x:Static local:EnumEqualsConverter.Instance}, ConverterParameter=Pencil}"
											 Width="28" Padding="4,2"/>
								<RadioButton GroupName="DrawingTool" Content="ðŸª£" ToolTip.Tip="Fill"
											 IsChecked="{Binding CurrentDrawingTool, Converter={x:Static local:EnumEqualsConverter.Instance}, ConverterParameter=Fill}"
											 Width="28" Padding="4,2"/>
								<RadioButton GroupName="DrawingTool" Content="ðŸ“" ToolTip.Tip="Line"
											 IsChecked="{Binding CurrentDrawingTool, Converter={x:Static local:EnumEqualsConverter.Instance}, ConverterParameter=Line}"
											 Width="28" Padding="4,2"/>
								<RadioButton GroupName="DrawingTool" Content="â¬œ" ToolTip.Tip="Rectangle"
											 IsChecked="{Binding CurrentDrawingTool, Converter={x:Static local:EnumEqualsConverter.Instance}, ConverterParameter=Rectangle}"
											 Width="28" Padding="4,2"/>
								<RadioButton GroupName="DrawingTool" Content="ðŸ’‰" ToolTip.Tip="Eyedropper"
											 IsChecked="{Binding CurrentDrawingTool, Converter={x:Static local:EnumEqualsConverter.Instance}, ConverterParameter=Eyedropper}"
											 Width="28" Padding="4,2"/>
								<RadioButton GroupName="DrawingTool" Content="âŠ¡" ToolTip.Tip="Selection"
											 IsChecked="{Binding CurrentDrawingTool, Converter={x:Static local:EnumEqualsConverter.Instance}, ConverterParameter=Selection}"
											 Width="28" Padding="4,2"/>
							</StackPanel>

							<!-- Selection operations (shown when selection tool is active) -->
							<StackPanel Orientation="Horizontal" Spacing="4" IsVisible="{Binding IsPixelEditMode}">
								<Button Content="Copy" Command="{Binding CopyPixelSelectionCommand}" ToolTip.Tip="Copy selection"
										FontSize="10" Padding="4,2" IsVisible="{Binding PixelSelection, Converter={x:Static ObjectConverters.IsNotNull}}"/>
								<Button Content="Paste" Command="{Binding PastePixelSelectionCommand}" ToolTip.Tip="Paste selection"
										FontSize="10" Padding="4,2" IsEnabled="{Binding HasPixelClipboard}"/>
								<Button Content="Fill" Command="{Binding FillPixelSelectionCommand}" ToolTip.Tip="Fill selection with color"
										FontSize="10" Padding="4,2" IsVisible="{Binding PixelSelection, Converter={x:Static ObjectConverters.IsNotNull}}"/>
								<Button Content="Clear Sel" Command="{Binding ClearPixelSelectionCommand}" ToolTip.Tip="Clear selection"
										FontSize="10" Padding="4,2" IsVisible="{Binding PixelSelection, Converter={x:Static ObjectConverters.IsNotNull}}"/>
							</StackPanel>
						</StackPanel>

						<Separator/>

						<!-- Palette Display -->
						<StackPanel Spacing="8">
							<TextBlock Text="Current Palette" FontWeight="SemiBold"/>
							<TextBlock Text="Double-click color to edit" FontSize="10" Opacity="0.7"/>
							<controls:PaletteEditor
								x:Name="PaletteEditorControl"
								Colors="{Binding CurrentPalette}"
								SelectedColorIndex="{Binding SelectedColorIndex}"
								SwatchSize="32"
								SwatchSpacing="4"
								IsReadOnly="False"/>
						</StackPanel>

						<Separator/>

						<!-- Transform Previews -->
						<TextBlock Text="Transform Previews" FontWeight="SemiBold"/>
						<TextBlock Text="Click to apply transformation:" Opacity="0.7" FontSize="11"/>

						<Grid ColumnDefinitions="*,*,*" RowDefinitions="Auto,Auto,Auto,Auto" HorizontalAlignment="Left">
							<!-- Row 0: Labels -->
							<TextBlock Grid.Row="0" Grid.Column="0" Text="Flip H" HorizontalAlignment="Center" FontSize="10" Opacity="0.7"/>
							<TextBlock Grid.Row="0" Grid.Column="1" Text="Flip V" HorizontalAlignment="Center" FontSize="10" Opacity="0.7"/>
							<TextBlock Grid.Row="0" Grid.Column="2" Text="90Â°" HorizontalAlignment="Center" FontSize="10" Opacity="0.7"/>

							<!-- Row 1: Previews -->
							<Button Grid.Row="1" Grid.Column="0" Command="{Binding ApplyFlipHorizontalCommand}"
									Background="Transparent" Padding="4" Margin="2">
								<Border Background="Black" CornerRadius="2" Padding="2">
									<controls:TileCanvas TileData="{Binding PreviewFlipH}"
														 Palette="{Binding CurrentPalette}" Scale="4"/>
								</Border>
							</Button>
							<Button Grid.Row="1" Grid.Column="1" Command="{Binding ApplyFlipVerticalCommand}"
									Background="Transparent" Padding="4" Margin="2">
								<Border Background="Black" CornerRadius="2" Padding="2">
									<controls:TileCanvas TileData="{Binding PreviewFlipV}"
														 Palette="{Binding CurrentPalette}" Scale="4"/>
								</Border>
							</Button>
							<Button Grid.Row="1" Grid.Column="2" Command="{Binding ApplyRotate90Command}"
									Background="Transparent" Padding="4" Margin="2">
								<Border Background="Black" CornerRadius="2" Padding="2">
									<controls:TileCanvas TileData="{Binding PreviewRotate90}"
														 Palette="{Binding CurrentPalette}" Scale="4"/>
								</Border>
							</Button>

							<!-- Row 2: Labels -->
							<TextBlock Grid.Row="2" Grid.Column="0" Text="180Â°" HorizontalAlignment="Center" FontSize="10" Opacity="0.7"/>
							<TextBlock Grid.Row="2" Grid.Column="1" Text="270Â°" HorizontalAlignment="Center" FontSize="10" Opacity="0.7"/>

							<!-- Row 3: More Previews -->
							<Button Grid.Row="3" Grid.Column="0" Command="{Binding ApplyRotate180Command}"
									Background="Transparent" Padding="4" Margin="2">
								<Border Background="Black" CornerRadius="2" Padding="2">
									<controls:TileCanvas TileData="{Binding PreviewRotate180}"
														 Palette="{Binding CurrentPalette}" Scale="4"/>
								</Border>
							</Button>
							<Button Grid.Row="3" Grid.Column="1" Command="{Binding ApplyRotate270Command}"
									Background="Transparent" Padding="4" Margin="2">
								<Border Background="Black" CornerRadius="2" Padding="2">
									<controls:TileCanvas TileData="{Binding PreviewRotate270}"
														 Palette="{Binding CurrentPalette}" Scale="4"/>
								</Border>
							</Button>
						</Grid>

						<Separator/>

						<!-- Statistics -->
						<TextBlock Text="Statistics" FontWeight="SemiBold"/>
						<StackPanel Spacing="4">
							<TextBlock Text="{Binding TileCount, StringFormat=Total Tiles: {0}}" Opacity="0.7"/>
							<TextBlock Text="{Binding BankCount, StringFormat=Banks: {0}}" Opacity="0.7"/>
							<TextBlock Text="{Binding TileFormat, StringFormat=Format: {0}}" Opacity="0.7"/>
						</StackPanel>

						<Separator/>

						<!-- Animation Preview & Frame Editor -->
						<TextBlock Text="Animation Preview" FontWeight="SemiBold"/>
						<StackPanel Spacing="8">
							<StackPanel Orientation="Horizontal" Spacing="4">
								<Button Content="+ Frame" Command="{Binding AddAnimationFrameCommand}"
										ToolTip.Tip="Add current tile as animation frame" FontSize="11" Padding="6,4"/>
								<Button Content="- Frame" Command="{Binding RemoveAnimationFrameCommand}"
										ToolTip.Tip="Remove last animation frame" FontSize="11" Padding="6,4"/>
								<Button Content="Clear" Command="{Binding ClearAnimationFramesCommand}"
										ToolTip.Tip="Clear all frames" FontSize="11" Padding="6,4"/>
							</StackPanel>

							<StackPanel Orientation="Horizontal" Spacing="4">
								<Button Content="4 from Tile" Command="{Binding CreateAnimationFromRangeCommand}"
										ToolTip.Tip="Create 4-frame animation from selected tile" FontSize="11" Padding="6,4"/>
								<Button Content="Reverse" Command="{Binding ReverseAnimationFramesCommand}"
										ToolTip.Tip="Reverse frame order" FontSize="11" Padding="6,4"/>
								<ToggleButton Content="â–¶" IsChecked="{Binding IsAnimationPlaying}"
											  ToolTip.Tip="Play/pause animation" Width="28"/>
							</StackPanel>

							<TextBlock Text="{Binding AnimationFrames.Count, StringFormat={}{0} frames}" Opacity="0.7" FontSize="11"/>

							<!-- Animation preview canvas -->
							<Border Background="Black" CornerRadius="4" Padding="4" HorizontalAlignment="Left"
									IsVisible="{Binding AnimationFrames.Count}">
								<controls:AnimatedTilePreview
									Frames="{Binding AnimationFrames}"
									Palette="{Binding CurrentPalette}"
									Scale="4"
									IsPlaying="{Binding IsAnimationPlaying}"
									FrameDelayMs="{Binding AnimationSpeedMs}"/>
							</Border>

							<!-- Animation speed slider -->
							<StackPanel Orientation="Horizontal" Spacing="4" IsVisible="{Binding AnimationFrames.Count}">
								<TextBlock Text="Speed:" VerticalAlignment="Center" FontSize="11"/>
								<Slider Value="{Binding AnimationSpeedMs}" Minimum="50" Maximum="1000"
										Width="80" VerticalAlignment="Center"/>
								<TextBlock Text="{Binding AnimationSpeedMs, StringFormat={}{0}ms}" FontSize="11" Opacity="0.7" VerticalAlignment="Center"/>
							</StackPanel>

							<!-- Frame list with simple controls -->
							<Border Background="{DynamicResource SystemControlBackgroundChromeLowBrush}"
									CornerRadius="4" Padding="4" IsVisible="{Binding AnimationFrames.Count}">
								<StackPanel Spacing="2">
									<TextBlock Text="Frames:" FontSize="10" Opacity="0.7"/>
									<ScrollViewer MaxHeight="100" HorizontalScrollBarVisibility="Disabled">
										<ItemsControl ItemsSource="{Binding AnimationFrames}">
											<ItemsControl.ItemsPanel>
												<ItemsPanelTemplate>
													<WrapPanel Orientation="Horizontal"/>
												</ItemsPanelTemplate>
											</ItemsControl.ItemsPanel>
											<ItemsControl.ItemTemplate>
												<DataTemplate>
													<Border Padding="2" Margin="1" CornerRadius="2"
															Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}">
														<Border Background="Black" CornerRadius="2" Padding="1">
															<controls:TileCanvas TileData="{Binding}"
																				 Palette="{Binding $parent[UserControl].DataContext.CurrentPalette}"
																				 Scale="2" ShowGrid="False"/>
														</Border>
													</Border>
												</DataTemplate>
											</ItemsControl.ItemTemplate>
										</ItemsControl>
									</ScrollViewer>
								</StackPanel>
							</Border>
						</StackPanel>
					</StackPanel>
				</ScrollViewer>
			</Border>
		</Grid>

		<!-- Status Bar -->
		<Border Grid.Row="2" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" Padding="16,8">
			<TextBlock Text="{Binding StatusText}"/>
		</Border>
	</Grid>
</UserControl>

<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:vm="using:GameInfoTools.UI.ViewModels"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
			 x:Class="GameInfoTools.UI.Views.ScriptEditorView"
			 x:DataType="vm:ScriptEditorViewModel">

	<Design.DataContext>
		<vm:ScriptEditorViewModel/>
	</Design.DataContext>

	<Grid RowDefinitions="Auto,*,Auto">
		<!-- Toolbar -->
		<StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Margin="16,16,16,8">
			<TextBlock Text="Offset:" VerticalAlignment="Center"/>
			<NumericUpDown Value="{Binding ScriptOffset}" Minimum="0" Maximum="16777215" Width="100" FormatString="X6"/>
			<TextBlock Text="Length:" VerticalAlignment="Center"/>
			<NumericUpDown Value="{Binding ScriptLength}" Minimum="1" Maximum="65536" Width="80"/>
			<Separator/>
			<TextBlock Text="Type:" VerticalAlignment="Center"/>
			<ComboBox ItemsSource="{Binding ScriptTypes}" SelectedItem="{Binding SelectedScriptType}" Width="120"/>
			<Separator/>
			<Button Content="Load" Command="{Binding LoadScriptCommand}" ToolTip.Tip="Load and disassemble script"/>
			<Button Content="Find Scripts" Command="{Binding FindScriptsCommand}" ToolTip.Tip="Search for scripts in ROM"/>
			<Separator/>
			<Button Content="Load Opcodes..." Command="{Binding LoadOpcodeTableCommand}" CommandParameter="{Binding $parent[Window]}" ToolTip.Tip="Load opcode definition table"/>
			<Button Content="Export..." Command="{Binding ExportScriptCommand}" CommandParameter="{Binding $parent[Window]}" ToolTip.Tip="Export disassembled script"/>
		</StackPanel>

		<!-- Main Content -->
		<Grid Grid.Row="1" ColumnDefinitions="*,300" Margin="16,8">
			<!-- Disassembly View -->
			<Border Grid.Column="0" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
					CornerRadius="4" Padding="8" Margin="0,0,8,0">
				<DockPanel>
					<TextBlock DockPanel.Dock="Top" Text="{Binding ScriptName, FallbackValue=Script Disassembly}" FontWeight="SemiBold" Margin="0,0,0,8"/>

					<Grid RowDefinitions="*,8,*">
						<!-- Commands List -->
						<ListBox Grid.Row="0" ItemsSource="{Binding Commands}" SelectedItem="{Binding SelectedCommand}">
							<ListBox.ItemTemplate>
								<DataTemplate>
									<TextBlock Text="{Binding Disassembly}" FontFamily="Consolas" FontSize="12"/>
								</DataTemplate>
							</ListBox.ItemTemplate>
						</ListBox>

						<GridSplitter Grid.Row="1" ResizeDirection="Rows" HorizontalAlignment="Stretch"/>

						<!-- Raw Hex View -->
						<Border Grid.Row="2" Background="{DynamicResource SystemControlBackgroundAltHighBrush}" CornerRadius="4" Padding="8">
							<DockPanel>
								<TextBlock DockPanel.Dock="Top" Text="Raw Hex" FontWeight="SemiBold" Margin="0,0,0,4"/>
								<ScrollViewer>
									<TextBlock Text="{Binding RawHex}" FontFamily="Consolas" FontSize="11" TextWrapping="Wrap"/>
								</ScrollViewer>
							</DockPanel>
						</Border>
					</Grid>
				</DockPanel>
			</Border>

			<!-- Opcode Reference -->
			<Border Grid.Column="1" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
					CornerRadius="4" Padding="16">
				<ScrollViewer>
					<StackPanel Spacing="16">
						<TextBlock Text="Opcode Reference" FontWeight="SemiBold" FontSize="16"/>

						<ListBox ItemsSource="{Binding Opcodes}" MaxHeight="300">
							<ListBox.ItemTemplate>
								<DataTemplate>
									<Grid ColumnDefinitions="40,60,*">
										<TextBlock Grid.Column="0" Text="{Binding Code, StringFormat={}{0:X2}}" FontFamily="Consolas"/>
										<TextBlock Grid.Column="1" Text="{Binding Name}" FontWeight="SemiBold"/>
										<TextBlock Grid.Column="2" Text="{Binding Description}" Opacity="0.7"/>
									</Grid>
								</DataTemplate>
							</ListBox.ItemTemplate>
						</ListBox>

						<Separator/>

						<TextBlock Text="Selected Command" FontWeight="SemiBold"/>
						<StackPanel Spacing="4" IsVisible="{Binding SelectedCommand, Converter={x:Static ObjectConverters.IsNotNull}}">
							<TextBlock Text="{Binding SelectedCommand.Name}" FontWeight="SemiBold" FontSize="14"/>
							<TextBlock Text="{Binding SelectedCommand.Offset, StringFormat=Offset: 0x{0:X6}}" Opacity="0.7"/>
							<TextBlock Text="{Binding SelectedCommand.Opcode, StringFormat=Opcode: 0x{0:X2}}" Opacity="0.7"/>
							<TextBlock Text="{Binding SelectedCommand.Description}" TextWrapping="Wrap"/>
						</StackPanel>
						<TextBlock Text="No command selected" Opacity="0.5" IsVisible="{Binding SelectedCommand, Converter={x:Static ObjectConverters.IsNull}}"/>

						<Separator/>

						<TextBlock Text="Script Statistics" FontWeight="SemiBold"/>
						<TextBlock Text="{Binding Commands.Count, StringFormat=Commands: {0}}" Opacity="0.7"/>
					</StackPanel>
				</ScrollViewer>
			</Border>
		</Grid>

		<!-- Status Bar -->
		<Border Grid.Row="2" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" Padding="16,8">
			<Grid ColumnDefinitions="*,Auto">
				<TextBlock Grid.Column="0" Text="{Binding StatusText}"/>
				<TextBlock Grid.Column="1" Text="{Binding Commands.Count, StringFormat={}{0} commands}"/>
			</Grid>
		</Border>
	</Grid>
</UserControl>

<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:vm="using:GameInfoTools.UI.ViewModels"
			 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
			 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
			 mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
			 x:Class="GameInfoTools.UI.Views.TasConverterView"
			 x:DataType="vm:TasConverterViewModel">

	<Design.DataContext>
		<vm:TasConverterViewModel/>
	</Design.DataContext>

	<Grid RowDefinitions="Auto,*,Auto">
		<!-- Toolbar -->
		<Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" Padding="8">
			<StackPanel Orientation="Horizontal" Spacing="8">
				<Button Content="ðŸ“‚ Open TAS" Command="{Binding OpenFileCommand}" ToolTip.Tip="Open a TAS replay file"/>
				<Separator/>
				<TextBlock Text="Convert to:" VerticalAlignment="Center"/>
				<ComboBox Width="150"
						  ItemsSource="{Binding AvailableFormats}"
						  SelectedValue="{Binding SelectedTargetFormat}"
						  SelectedValueBinding="{Binding Name}"
						  DisplayMemberBinding="{Binding Name}"
						  ToolTip.Tip="Select target format"/>
				<Button Content="â–¶ Convert" Command="{Binding ConvertCommand}"
						IsEnabled="{Binding HasFileLoaded}"
						ToolTip.Tip="Convert to selected format"/>
				<Separator/>
				<CheckBox Content="Strip Savestate" IsChecked="{Binding StripSavestate}" VerticalAlignment="Center"/>
				<CheckBox Content="Strip SRAM" IsChecked="{Binding StripSram}" VerticalAlignment="Center"/>
				<Separator/>
				<Button Content="âœ“ Validate" Command="{Binding ValidateFileCommand}"
						IsEnabled="{Binding HasFileLoaded}"
						ToolTip.Tip="Validate file structure"/>
				<Button Content="ðŸ“‹ List Formats" Command="{Binding ListFormatsCommand}"
						ToolTip.Tip="Show all supported formats"/>
			</StackPanel>
		</Border>

		<!-- Main Content -->
		<Grid Grid.Row="1" ColumnDefinitions="350,*" Margin="8">
			<!-- Left Panel - File Info -->
			<Grid Grid.Column="0" RowDefinitions="Auto,Auto,*" Margin="0,0,8,0">
				<!-- File Information Panel -->
				<Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
						CornerRadius="4" Padding="16" Margin="0,0,0,8">
					<StackPanel Spacing="8">
						<TextBlock Text="File Information" FontWeight="Bold" FontSize="14"/>
						<Separator/>
						<Grid ColumnDefinitions="100,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto">
							<TextBlock Grid.Row="0" Grid.Column="0" Text="File:" Opacity="0.7"/>
							<TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding FileName}" FontWeight="SemiBold"/>

							<TextBlock Grid.Row="1" Grid.Column="0" Text="Format:" Opacity="0.7"/>
							<TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding FormatName}"/>

							<TextBlock Grid.Row="2" Grid.Column="0" Text="Emulator:" Opacity="0.7"/>
							<TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding EmulatorName}"/>

							<TextBlock Grid.Row="3" Grid.Column="0" Text="System:" Opacity="0.7"/>
							<TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding SystemName}"/>

							<TextBlock Grid.Row="4" Grid.Column="0" Text="Frames:" Opacity="0.7"/>
							<TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding FrameCount, StringFormat={}{0:N0}}"/>

							<TextBlock Grid.Row="5" Grid.Column="0" Text="Duration:" Opacity="0.7"/>
							<TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding Duration}"/>

							<TextBlock Grid.Row="6" Grid.Column="0" Text="Controllers:" Opacity="0.7"/>
							<TextBlock Grid.Row="6" Grid.Column="1" Text="{Binding ControllerCount}"/>
						</Grid>
					</StackPanel>
				</Border>

				<!-- Metadata Panel -->
				<Border Grid.Row="1" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
						CornerRadius="4" Padding="16" Margin="0,0,0,8">
					<StackPanel Spacing="8">
						<TextBlock Text="Movie Metadata" FontWeight="Bold" FontSize="14"/>
						<Separator/>
						<Grid ColumnDefinitions="100,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto">
							<TextBlock Grid.Row="0" Grid.Column="0" Text="Author:" Opacity="0.7"/>
							<TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Author}"/>

							<TextBlock Grid.Row="1" Grid.Column="0" Text="ROM:" Opacity="0.7"/>
							<TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding RomName}" TextWrapping="Wrap"/>

							<TextBlock Grid.Row="2" Grid.Column="0" Text="Rerecords:" Opacity="0.7"/>
							<TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding RerecordCount, StringFormat={}{0:N0}}"/>

							<TextBlock Grid.Row="3" Grid.Column="0" Text="Region:" Opacity="0.7"/>
							<TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding Region}"/>

							<TextBlock Grid.Row="4" Grid.Column="0" Text="Start Type:" Opacity="0.7"/>
							<TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding StartType}"/>

							<TextBlock Grid.Row="5" Grid.Column="0" Text="Extras:" Opacity="0.7"/>
							<StackPanel Grid.Row="5" Grid.Column="1" Orientation="Horizontal" Spacing="8">
								<TextBlock Text="ðŸ’¾" IsVisible="{Binding HasSavestate}" ToolTip.Tip="Has Savestate"/>
								<TextBlock Text="ðŸ“¦" IsVisible="{Binding HasSram}" ToolTip.Tip="Has SRAM"/>
							</StackPanel>
						</Grid>
					</StackPanel>
				</Border>

				<!-- Controllers Panel -->
				<Border Grid.Row="2" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
						CornerRadius="4" Padding="16">
					<Grid RowDefinitions="Auto,*">
						<StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
							<TextBlock Text="Controllers" FontWeight="Bold" FontSize="14"/>
							<Button Content="ðŸ“‹" Command="{Binding CopyMetadataCommand}" ToolTip.Tip="Copy metadata JSON"/>
						</StackPanel>
						<ListBox Grid.Row="1" ItemsSource="{Binding Controllers}" BorderThickness="0">
							<ListBox.ItemTemplate>
								<DataTemplate x:DataType="vm:ControllerDisplay">
									<StackPanel Orientation="Horizontal" Spacing="8">
										<TextBlock Text="ðŸŽ®" FontSize="16"/>
										<TextBlock Text="{Binding Port, StringFormat=Port {0}}" VerticalAlignment="Center"/>
										<TextBlock Text="{Binding Type}" Opacity="0.7" VerticalAlignment="Center"/>
									</StackPanel>
								</DataTemplate>
							</ListBox.ItemTemplate>
						</ListBox>
					</Grid>
				</Border>
			</Grid>

			<!-- Right Panel - Frame Preview and Metadata -->
			<Grid Grid.Column="1" RowDefinitions="*,300">
				<!-- Frame Preview -->
				<Border Grid.Row="0" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
						CornerRadius="4" Padding="8" Margin="0,0,0,8">
					<Grid RowDefinitions="Auto,*">
						<StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
							<TextBlock Text="Frame Preview" FontWeight="Bold" FontSize="14"/>
							<TextBlock Text="(First 1000 frames)" Opacity="0.6"/>
						</StackPanel>
						<DataGrid Grid.Row="1"
								  ItemsSource="{Binding DisplayedFrames}"
								  IsReadOnly="True"
								  CanUserReorderColumns="False"
								  CanUserResizeColumns="True"
								  GridLinesVisibility="Horizontal"
								  HeadersVisibility="Column"
								  BorderThickness="0">
							<DataGrid.Columns>
								<DataGridTextColumn Header="Frame" Binding="{Binding Frame}" Width="70"/>
								<DataGridTextColumn Header="Buttons" Binding="{Binding Buttons}" Width="*"/>
								<DataGridTextColumn Header="Commands" Binding="{Binding Commands}" Width="100"/>
							</DataGrid.Columns>
						</DataGrid>
					</Grid>
				</Border>

				<!-- Metadata JSON / Info Panel -->
				<Border Grid.Row="1" Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
						CornerRadius="4" Padding="8">
					<Grid RowDefinitions="Auto,*">
						<TextBlock Grid.Row="0" Text="Metadata / Output" FontWeight="Bold" FontSize="14" Margin="0,0,0,8"/>
						<TextBox Grid.Row="1"
								 Text="{Binding MetadataJson}"
								 IsReadOnly="True"
								 AcceptsReturn="True"
								 TextWrapping="Wrap"
								 FontFamily="Cascadia Code, Consolas, monospace"
								 FontSize="12"/>
					</Grid>
				</Border>
			</Grid>
		</Grid>

		<!-- Status Bar -->
		<Border Grid.Row="2" Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" Padding="8,4">
			<Grid ColumnDefinitions="*,Auto">
				<TextBlock Grid.Column="0" Text="{Binding StatusText}" VerticalAlignment="Center"/>
				<ProgressBar Grid.Column="1" Width="150" Height="8"
							 IsVisible="{Binding IsConverting}"
							 Value="{Binding ConversionProgress}"
							 Minimum="0" Maximum="100"/>
			</Grid>
		</Border>
	</Grid>
</UserControl>

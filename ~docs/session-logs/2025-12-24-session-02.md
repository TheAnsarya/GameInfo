# Session Log: 2025-12-24 Session 02

## Session Overview

**Date:** 2025-12-24
**Focus:** ROM Catalog System Development
**Branch:** `feature/darkrepos-wiki`

## Summary

Created a comprehensive ROM catalog system that allows scripts to reference ROM files by hash, even though the actual ROM files are excluded from source control due to copyright. This system enables tools to work with ROMs when the user has obtained them and placed them in the `~roms/` folder.

## Work Completed

### 1. ROM Catalog Generator Script (`tools/rom_catalog_generator.py`)

Created a ~1000 line Python script that:
- Scans a directory recursively for ROM files
- Calculates 7 different hash algorithms:
  - CRC32 (quick identification, GoodTools/No-Intro)
  - MD5 (legacy databases)
  - SHA-1 (No-Intro/Redump standard)
  - SHA-256, SHA-512 (modern verification)
  - BLAKE2b, BLAKE3 (modern fast hashing)
- Parses platform-specific headers:
  - **SNES**: LoROM/HiROM detection, mapper type, ROM type, SRAM, country, checksum
  - **NES**: iNES/NES2.0 format, PRG/CHR sizes, mapper (60+ named), mirroring, battery
  - **GBA**: Title, game code, maker code (100+ named), version
- Parses GoodTools filename format for metadata:
  - Region codes (U, E, J, F, G, etc.)
  - Version numbers (V1.0, V1.1)
  - Dump flags ([!] verified, [b] bad, [o] overdump, [h] hack)
  - Prototype/beta flags
- Outputs nested folder structure in JSON

### 2. ROM Catalog JSON (`data/rom_catalog.json`)

Generated catalog containing:
- 111 SNES ROM files
- Total size: 180.75 MB
- Games include:
  - Soul Blazer (U, E, F, G, J) - main project focus
  - Final Fantasy Mystic Quest (multiple versions)
  - Dragon Quest I-VI (SNES Japanese versions)
  - Chrono Trigger (U, J)
  - Secret of Mana/Evermore
  - Legend of Zelda: A Link to the Past
  - Lufia series
  - Megaman/Rockman X series
  - And many more

### 3. ROM Catalog Helper Module (`tools/rom_catalog_helper.py`)

Created a helper module for easy ROM lookups:
- `RomInfo` dataclass with all ROM metadata
- `RomCatalogHelper` class with methods:
  - `find_by_crc32()`, `find_by_md5()`, `find_by_sha1()`, `find_by_sha256()`
  - `find_by_hash()` - auto-detects hash type by length
  - `find_by_name()` - search by name with filters
  - `find_by_platform()` - list all ROMs for a platform
  - `find_by_mapper()` - find NES ROMs by mapper number
  - `get_rom_path()` - resolve filesystem path
  - `rom_exists()` - check if ROM is present
  - `read_rom()` - load ROM data
- Convenience methods:
  - `get_soul_blazer(region)` - find Soul Blazer by region
  - `get_ffmq(region, version)` - find FFMQ variants
  - `get_dragon_quest(game)` - find DQ1-6

### 4. Documentation (`docs/guides/rom-catalog.md`)

Created comprehensive documentation covering:
- Catalog structure and fields
- All 7 hash algorithms with use cases
- SNES header fields and values
- NES header fields (iNES/NES2.0)
- GBA header fields
- GoodTools filename parsing
- Usage examples with code
- Known ROM reference tables

## Files Created/Modified

### Created
- `tools/rom_catalog_generator.py` (~1000 lines)
- `tools/rom_catalog_helper.py` (~550 lines)
- `data/rom_catalog.json` (5000+ lines)
- `docs/guides/rom-catalog.md` (~370 lines)

### Git Commits
1. `ddab9e8` - feat: add ROM catalog system for hash-based ROM reference
2. `83f6b40` - feat: add NES and GBA header parsing to ROM catalog generator
3. `f45641e` - docs: add NES and GBA header documentation to ROM catalog guide
4. `539dfdb` - feat: add NES/GBA header support and convenience methods to helper

## Technical Notes

### NES Header Parsing
- Tested with Dragon Warrior IV NES ROM from dragon-warrior-4-info project
- Successfully detected: MMC1 mapper, 512KB PRG ROM, battery backup, horizontal mirroring
- Supports both iNES and NES2.0 formats
- Extended mapper support (0-255+ for NES2.0)

### SNES Header Detection
- Validates via checksum XOR complement = $FFFF
- Tries LoROM offset ($7FC0) first, then HiROM ($FFC0)
- Handles 512-byte copier headers

### Hash Performance
- BLAKE2b is fastest for large files
- BLAKE3 optional (requires additional package)
- CRC32 included for GoodTools compatibility

## What's Next

1. Push commits to remote
2. Create additional NES ROMs catalog if user adds NES ROMs to `~roms/NES/`
3. Integrate ROM catalog with existing Soul Blazer tools
4. Use ROM catalog in asset extraction scripts
5. Continue Soul Blazer wiki documentation

## Session Statistics

- Time: ~45 minutes
- Files created: 4
- Lines of code: ~1,900+
- Git commits: 4
- ROMs cataloged: 111

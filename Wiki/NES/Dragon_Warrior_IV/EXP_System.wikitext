{{Back|Dragon Warrior IV (NES)}}
{{DISPLAYTITLE:Dragon Warrior IV - EXP System}}

= Dragon Warrior IV (NES) - EXP System =

This page documents the experience point system in Dragon Warrior IV, including the formula-based calculation and ROM data locations.

'''Data Status:''' EXP calculation routine verified at Bank 18 ($9f7c). Coefficient tables at $a0fb.

== ROM Data Locations ==

{| class="wikitable"
|-
! Data Type !! ROM Address !! Bank !! Size !! Description
|-
| EXP calc routine || $49f7c || 18 ($9f7c) || ~100 bytes || Main calculation
|-
| Level check || $49c22 || 18 ($9c22) || ~150 bytes || Level-up comparison
|-
| Pointer table || $4a0fb || 18 ($a0fb) || 16 bytes || Character curve pointers
|-
| Coefficient data || $4a123+ || 18 ($a123+) || Variable || Per-character curves
|}

== Overview ==

Dragon Warrior IV uses a '''formula-based EXP calculation''' rather than storing all 99 level values for each character. This space-efficient approach uses coefficient tables to calculate EXP requirements dynamically.

=== Design Benefits ===

* Saves ~2KB of ROM (8 chars × 99 levels × 3 bytes each)
* Characters can share curves, further reducing data
* Allows fine-tuning of level progression

== Key Memory Locations ==

=== RAM ===

{| class="wikitable"
! Address !! Size !! Description
|-
| $72-$74 || 3 bytes || Current character's EXP (little-endian)
|-
| $6e19-$6e1b,X || 3 bytes || Calculated EXP requirement for next level (indexed)
|-
| $6e3c || 1 byte || Loop counter for party processing
|-
| $6e || 1 byte || Current character index being processed
|}

=== ROM (Bank 18) ===

{| class="wikitable"
! Address !! Size !! Description
|-
| $a0fb || 16 bytes || Pointer table to EXP coefficient data
|-
| $a123+ || Variable || Character-specific EXP coefficient data
|}

== EXP Calculation Routine ==

Located in Bank 18 at $9f7c:

<pre>
loc_9F7C:
    LDA $0b             ; Character class index
    CMP #$06            ; Special case check
    BEQ $9f88
    JSR $9f9c           ; Load coefficients
    JMP $9fb9           ; Calculate EXP
</pre>

=== Coefficient Loader ($9f9c) ===

<pre>
loc_9F9C:
    ASL                 ; Index * 2 (16-bit pointer)
    TAX
    LDA $a0fb,X         ; Load pointer low byte
    STA $0c
    LDA $a0fc,X         ; Load pointer high byte
    STA $0d
    ; ... continues with calculation
</pre>

== Character EXP Curves ==

=== Pointer Table at $a0fb ===

{| class="wikitable"
! Index !! Pointer !! Character(s)
|-
| 0 || $a123 || Hero
|-
| 1 || $a14b || Cristo
|-
| 2 || $a17b || Nara
|-
| 3 || $a1ab || Mara
|-
| 4 || $a1db || Brey
|-
| 5 || $a20b || Taloon
|-
| 6 || $a1ab || (shares with Mara)
|-
| 7 || $a23b || Ragnar
|}

'''Note:''' Entries 3 and 6 point to the same address ($a1ab), suggesting Mara and another character (possibly Alena) share the same EXP curve.

== Level-Up Check ==

Located in Bank 18 at $9c22:

<pre>
    CMP #$63            ; Compare to max level 99
    BEQ skip            ; If max level, skip
    ; ... get level, calculate EXP needed
    
    ; Compare current EXP to required
    LDA $6e19,Y         ; Get required EXP low byte
    SEC
    SBC $72             ; Subtract current EXP
    STA $00
    LDA $6e1a,Y         ; Mid byte
    SBC $73
    STA $01
    LDA $6e1b,Y         ; High byte
    SBC $74
    STA $02
</pre>

=== Level-Up Comparison ($9caa-$9cbf) ===

<pre>
    LDA $74             ; Current EXP high byte
    CMP $6e1b,X         ; Required EXP high byte
    BCC no_levelup      ; If current < required, no level up
    BNE levelup         ; If different, level up!
    
    LDA $73             ; Mid byte check
    CMP $6e1a,X
    BCC no_levelup
    BNE levelup
    
    LDA $72             ; Low byte check
    CMP $6e19,X
    BCS levelup         ; If current >= required, level up!
</pre>

== EXP Value Format ==

Experience points are stored as 24-bit (3-byte) little-endian integers:

{| class="wikitable"
! Byte !! Address (RAM) !! Description !! Range
|-
| Low || $72 || Bits 0-7 || 0-255
|-
| Mid || $73 || Bits 8-15 || 0-255
|-
| High || $74 || Bits 16-23 || 0-255
|}

'''Maximum EXP:''' 16,777,215 (0xFFFFFF)

== Implications ==

# '''Formula-based EXP''': The game calculates EXP requirements using coefficients, not a simple lookup table. This saves significant ROM space for 8 characters × 99 levels.

# '''Shared Curves''': Some characters share EXP curves, reducing the amount of coefficient data needed.

# '''24-bit EXP''': The 3-byte storage allows for EXP values up to ~16.7 million, sufficient for level 99.

== See Also ==

* [[Dragon Warrior IV:Characters|Characters]] - Character leveling and stats
* [[Dragon Warrior IV:Enemies|Enemies]] - Monster EXP rewards
* [[Dragon Warrior IV:Battle_System|Battle System]] - Combat mechanics
* [[Dragon Warrior IV:ROM_Map|ROM Map]] - Bank 18 and Bank 27 documentation
* [[Dragon Warrior IV:RAM_Map|RAM Map]] - Character data addresses

== References ==

* Bank 18 disassembly analysis
* dragon-warrior-4-info project

[[Category:Dragon Warrior IV]]
[[Category:Game Mechanics]]

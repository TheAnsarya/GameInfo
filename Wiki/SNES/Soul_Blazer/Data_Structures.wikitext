{{DISPLAYTITLE:Soul Blazer:Data Structures}}
This page documents the '''binary data structures and formats''' used in '''[[Soul Blazer]]''' (SNES).

==Overview==
Soul Blazer stores game data in several binary formats throughout the ROM:
* 4BPP graphics tiles
* Tilemap data with attributes
* Sprite metasprite definitions
* Text with custom encoding
* Pointer tables for dynamic data
* Save file format in SRAM

==Graphics Formats==

===4BPP Tile Format===
Standard SNES 4-bit-per-pixel tile format.

Each 8Ã—8 tile uses 32 bytes:
{| class="wikitable"
! Offset !! Size !! Description
|-
| $00-$0f || 16 || Bitplanes 0-1 (interleaved by row)
|-
| $10-$1f || 16 || Bitplanes 2-3 (interleaved by row)
|}

<pre>
Byte layout per row (row 0 example):
  Byte 0: bp0 row0 (bits 7-0 = pixels 0-7)
  Byte 1: bp1 row0
  ...continues for 8 rows...
  Byte 16: bp2 row0
  Byte 17: bp3 row0
  ...continues for 8 rows...

Pixel value = bp0 | (bp1 << 1) | (bp2 << 2) | (bp3 << 3)
Range: 0-15 (indexes into 16-color palette)
</pre>

===Palette Format===
SNES 15-bit BGR color format.

{| class="wikitable"
! Bits !! Description
|-
| 0-4 || Red (0-31)
|-
| 5-9 || Green (0-31)
|-
| 10-14 || Blue (0-31)
|-
| 15 || Unused (always 0)
|}

<pre>
Word format: 0bbbbbgggggrrrrr

Convert to 24-bit RGB:
  R8 = (R5 << 3) | (R5 >> 2)
  G8 = (G5 << 3) | (G5 >> 2)
  B8 = (B5 << 3) | (B5 >> 2)
</pre>

===Tilemap Format===
2-byte entries for each map tile.

{| class="wikitable"
! Bits !! Description
|-
| 0-9 || Tile number (0-1023)
|-
| 10-12 || Palette number (0-7)
|-
| 13 || Priority (0=low, 1=high)
|-
| 14 || X flip
|-
| 15 || Y flip
|}

<pre>
Word format: vhopppnnnnnnnnnn
  n = tile number
  p = palette
  o = priority
  h = horizontal flip
  v = vertical flip
</pre>

==Sprite Formats==

===OAM Entry===
Standard SNES OAM format (4 bytes per sprite).

{| class="wikitable"
! Offset !! Size !! Description
|-
| $00 || 1 || X position (low 8 bits)
|-
| $01 || 1 || Y position
|-
| $02 || 1 || Tile number (low byte)
|-
| $03 || 1 || Attributes
|}

Attributes byte:
{| class="wikitable"
! Bits !! Description
|-
| 0 || Tile number bit 8 (for 512-tile addressing)
|-
| 1-3 || Palette (offset into OBJ palette)
|-
| 4-5 || Priority (0-3)
|-
| 6 || X flip
|-
| 7 || Y flip
|}

===Metasprite Definition===
Soul Blazer uses variable-length metasprite definitions.

<pre>
Header:
  Byte 0: Number of sprites
  Byte 1: Bounding box width
  Byte 2: Bounding box height
  Byte 3: Hotspot X offset
  Byte 4: Hotspot Y offset

Per sprite (4 bytes each):
  Byte 0: X offset from hotspot (signed)
  Byte 1: Y offset from hotspot (signed)
  Byte 2: Tile number
  Byte 3: Attributes
</pre>

==Entity Structure==

===Entity Table Entry===
Each active entity uses a 32-byte slot.

{| class="wikitable"
! Offset !! Size !! Description
|-
| $00 || 1 || Entity type (0=inactive)
|-
| $01 || 1 || AI state
|-
| $02 || 2 || X position (16.0 fixed point)
|-
| $04 || 2 || Y position (16.0 fixed point)
|-
| $06 || 2 || X velocity (signed)
|-
| $08 || 2 || Y velocity (signed)
|-
| $0a || 1 || Direction (0-7, 8 directions)
|-
| $0b || 1 || Animation frame
|-
| $0c || 1 || Animation timer
|-
| $0d || 1 || Sprite priority
|-
| $0e || 2 || Current HP
|-
| $10 || 1 || Invincibility timer
|-
| $11 || 1 || Status flags
|-
| $12 || 1 || Attack power
|-
| $13 || 1 || Defense
|-
| $14 || 2 || Experience value
|-
| $16 || 2 || GEM drop value
|-
| $18 || 1 || Collision flags
|-
| $19 || 1 || Hit stun timer
|-
| $1a || 2 || Parent entity pointer
|-
| $1c || 2 || Target entity pointer
|-
| $1e || 2 || AI data pointer
|}

Direction values:
{| class="wikitable"
! Value !! Direction
|-
| 0 || East
|-
| 1 || Northeast
|-
| 2 || North
|-
| 3 || Northwest
|-
| 4 || West
|-
| 5 || Southwest
|-
| 6 || South
|-
| 7 || Southeast
|}

==Soul Lair Structure==

===Lair Data Entry===
Found in ROM starting at bank $18.

{| class="wikitable"
! Offset !! Size !! Description
|-
| $00 || 2 || Map X coordinate
|-
| $02 || 2 || Map Y coordinate
|-
| $04 || 1 || Lair type/appearance
|-
| $05 || 1 || Enemy type to spawn
|-
| $06 || 1 || Number of enemies
|-
| $07 || 1 || Spawn rate (frames)
|-
| $08 || 1 || Soul to release (NPC ID)
|-
| $09 || 1 || Flags
|}

Lair flags:
{| class="wikitable"
! Bit !! Description
|-
| 0 || Boss lair
|-
| 1 || Key item reward
|-
| 2 || Equipment reward
|-
| 3 || Magic reward
|-
| 4 || Required for progression
|-
| 5-7 || Reserved
|}

==Player Data Structure==

===Player Stats Block===
Located at RAM $7e1b00 (52 bytes).

{| class="wikitable"
! Offset !! Size !! Description
|-
| $00 || 2 || Current HP
|-
| $02 || 2 || Maximum HP
|-
| $04 || 2 || Current GEMs
|-
| $06 || 2 || Experience points
|-
| $08 || 1 || Level
|-
| $09 || 1 || Strength
|-
| $0a || 1 || Defense
|-
| $0b || 1 || Luck
|-
| $0c || 1 || Equipped sword
|-
| $0d || 1 || Equipped armor
|-
| $0e || 1 || Equipped magic
|-
| $0f || 1 || Soul count (released NPCs)
|-
| $10 || 4 || Sword inventory (bitfield)
|-
| $14 || 4 || Armor inventory (bitfield)
|-
| $18 || 4 || Magic inventory (bitfield)
|-
| $1c || 8 || Emblem inventory (bitfield)
|-
| $24 || 8 || Key items (bitfield)
|-
| $2c || 4 || Reserved
|-
| $30 || 2 || Play time (minutes)
|-
| $32 || 2 || Total GEMs collected
|}

==Text Encoding==

===Character Encoding Table===
Soul Blazer uses a custom text encoding. See the [[/TBL|TBL page]] for the complete table.

{| class="wikitable"
! Range !! Description
|-
| $00-$09 || Numbers 0-9
|-
| $0a-$23 || Uppercase A-Z
|-
| $24-$3d || Lowercase a-z
|-
| $3e || Space
|-
| $3f || Period
|-
| $40 || Comma
|-
| $41 || Question mark
|-
| $42 || Exclamation mark
|-
| $43 || Apostrophe
|-
| $44 || Quote
|-
| $45 || Hyphen
|-
| $46 || Colon
|-
| $47 || Ellipsis (...)
|-
| $fe || New line
|-
| $ff || End of string
|}

===Dialogue Pointer Format===
Dialogue uses a pointer table system.

<pre>
Pointer table header:
  Word 0: Number of entries
  Word 1+: 16-bit offsets to strings

String format:
  [Control codes][Text bytes][$ff]

Control codes:
  $f0 xx   : Pause xx frames
  $f1      : Wait for button press
  $f2 xx   : Set text color xx
  $f3 xx yy: Set position (x, y)
  $f4 xx   : Play sound effect xx
  $f5      : Clear text window
  $f6 nn   : Insert item name #nn
  $f7 nn   : Insert character name #nn
  $f8      : Insert player name
</pre>

==Compression==

===RLE Compression===
Used for some tilemap data.

<pre>
Format:
  $00-$7f: Copy next (n+1) bytes literally
  $80-$ff: Repeat next byte (n-127) times
  $00 $00: End of data
</pre>

===LZ Compression===
Used for graphics data in later banks.

<pre>
Header:
  Word 0: Uncompressed size
  Word 2: Compressed size

Commands:
  Bit 7=0: Literal run (lower 7 bits = length)
  Bit 7=1: Back reference
    Bits 4-6: Length - 3
    Bits 0-3 + next byte: Offset
</pre>

==See Also==
* [[/RAM Map|RAM Map]]
* [[/ROM Map|ROM Map]]
* [[/Data Tables|Data Tables]]
* [[/TBL|Text Table]]

[[Category:Soul Blazer]]
[[Category:Data Structures]]

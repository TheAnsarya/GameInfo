@page "/games"
@page "/games/{Platform}"
@using DarkRepos.Core.Models
@using DarkRepos.Core.Services

<PageTitle>Games - Dark Repos</PageTitle>

<HeadContent>
	<meta name="description"
		content="Browse our catalog of documented retro games with ROM maps, RAM maps, and data structures." />
</HeadContent>

<div class="container">
	<nav class="breadcrumbs" aria-label="Breadcrumb">
		<span class="breadcrumb-item"><a href="/">Home</a></span>
		<span class="breadcrumb-separator" aria-hidden="true">/</span>
		<span class="breadcrumb-item" aria-current="page">Games</span>
	</nav>

	<header class="page-header">
		<h1 class="page-title">Games Catalog</h1>
		<p class="page-description">
			Browse our collection of documented retro games with ROM maps, RAM maps, and detailed data structures.
		</p>
	</header>

	<div class="filter-bar" role="group" aria-label="Filter games by platform">
		<span class="text-secondary text-sm">Platform:</span>
		<div class="filter-group">
			<button class="filter-chip @(string.IsNullOrEmpty(Platform) ? "active" : "")"
				@onclick="@(() => FilterByPlatform(null))">
				All
			</button>
			<button class="filter-chip @(Platform == "nes" ? "active" : "")"
				@onclick="@(() => FilterByPlatform("nes"))">
				NES
			</button>
			<button class="filter-chip @(Platform == "snes" ? "active" : "")"
				@onclick="@(() => FilterByPlatform("snes"))">
				SNES
			</button>
			<button class="filter-chip @(Platform == "gb" ? "active" : "")" @onclick="@(() => FilterByPlatform("gb"))">
				GB
			</button>
			<button class="filter-chip @(Platform == "gbc" ? "active" : "")"
				@onclick="@(() => FilterByPlatform("gbc"))">
				GBC
			</button>
			<button class="filter-chip @(Platform == "gba" ? "active" : "")"
				@onclick="@(() => FilterByPlatform("gba"))">
				GBA
			</button>
			<button class="filter-chip @(Platform == "genesis" ? "active" : "")"
				@onclick="@(() => FilterByPlatform("genesis"))">
				Genesis
			</button>
		</div>
	</div>

	@if (IsLoading)
	{
		<LoadingSpinner Message="Loading games..." />
	}
	else if (FilteredGames.Any())
	{
		<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3" role="list">
			@foreach (var game in FilteredGames)
			{
				<GameCard Game="@game" ShowMeta="true" />
			}
		</div>

		<p role="status" class="sr-only">Showing @FilteredGames.Count() games</p>
	}
	else
	{
		@if (!string.IsNullOrEmpty(Platform))
		{
			<EmptyState Icon="ðŸŽ®" Title="No games found"
				Message="No games found for the selected platform. Try a different filter.">
				<ChildContent>
					<button class="btn btn-secondary" @onclick="() => FilterByPlatform(null)">
						Show all games
					</button>
				</ChildContent>
			</EmptyState>
		}
		else
		{
			<EmptyState Icon="ðŸŽ®" Title="No games found" Message="No games have been added yet. Check back soon!" />
		}
	}
</div>

@code {
	[Parameter]
	public string? Platform { get; set; }

	[Inject]
	private IContentService ContentService { get; set; } = null!;

	private List<Game> AllGames { get; set; } = [];
	private bool IsLoading { get; set; } = true;

	private IEnumerable<Game> FilteredGames => string.IsNullOrEmpty(Platform)
		? AllGames
		: AllGames.Where(g => g.Platform.ToString().Equals(Platform, StringComparison.OrdinalIgnoreCase));

	protected override async Task OnInitializedAsync()
	{
		IsLoading = true;
		try
		{
			var games = await ContentService.GetAllGamesAsync();
			AllGames = games.ToList();
		}
		finally
		{
			IsLoading = false;
		}
	}

	private void FilterByPlatform(string? platform)
	{
		Platform = platform;
		StateHasChanged();
	}
}
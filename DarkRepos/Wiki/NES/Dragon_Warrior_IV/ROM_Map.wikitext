{{Back|Dragon Warrior IV (NES)}}
{{rommap}}
{{subpage}}
{{DISPLAYTITLE:Dragon Warrior IV - ROM Map}}

= Dragon Warrior IV (NES) ROM Map =

This ROM map documents the PRG ROM layout of Dragon Warrior IV (US version), based on disassembly analysis by TheAnsarya and the dragon-warrior-4-info project.

== Overview ==

Dragon Warrior IV uses a complex ROM structure with 32 switchable 16KB banks. The game employs the MMC5 mapper, one of the most sophisticated NES mappers, providing expanded RAM and advanced bank switching capabilities.

== ROM Information ==

{| class="wikitable"
|-
! Property !! Value !! Notes
|-
| Title || Dragon Warrior IV || US localization
|-
| Region || US || Released October 1992
|-
| PRG ROM || 512KB (32 × 16KB) || Switchable banks
|-
| CHR ROM || 256KB || Pattern tables
|-
| Mapper || MMC5 (5) || Nintendo's advanced mapper
|-
| Banks || 32 PRG banks || 16KB each
|-
| Header || 16 bytes || iNES format
|-
| CRC32 || (varies by dump) || Multiple dumps exist
|}

== Bank Structure ==

Dragon Warrior IV uses the MMC5 mapper with 32 banks of 16KB PRG ROM ($4000 bytes each). Banks are addressed from $8000-$bfff (switchable) with Bank 31 fixed at $c000-$ffff.

=== Address Calculation ===

To convert between file offset and bank/CPU address:
* File Offset = $10 (header) + (Bank × $4000) + (CPU Address - $8000)
* CPU Address = $8000 + (File Offset - $10) MOD $4000

=== Bank Table ===

{| class="wikitable sortable"
|-
! Bank !! File Offset !! CPU Address !! Description !! Subroutines
|-
| Bank 00 || $00010-$04010 || $8000-$bfff || Map/world data || 22
|-
| Bank 01 || $04010-$08010 || $8000-$bfff || Map/world data || 17
|-
| Bank 02 || $08010-$0c010 || $8000-$bfff || Map/world data || 16
|-
| Bank 03 || $0c010-$10010 || $8000-$bfff || Map/world data || 14
|-
| Bank 04 || $10010-$14010 || $8000-$bfff || Item data tables || 22
|-
| Bank 05 || $14010-$18010 || $8000-$bfff || Equipment data || 12
|-
| Bank 06 || $18010-$1c010 || $8000-$bfff || '''Monster table, sprites''' || 57
|-
| Bank 07 || $1c010-$20010 || $8000-$bfff || Monster data || 75
|-
| Bank 08 || $20010-$24010 || $8000-$bfff || Monster data || 76
|-
| Bank 09 || $24010-$28010 || $8000-$bfff || Audio/music || 48
|-
| Bank 10 || $28010-$2c010 || $8000-$bfff || Audio/music, item names || 46
|-
| Bank 11 || $2c010-$30010 || $8000-$bfff || Audio/music || 37
|-
| Bank 12 || $30010-$34010 || $8000-$bfff || Text/dialog || 50
|-
| Bank 13 || $34010-$38010 || $8000-$bfff || Text/dialog || 39
|-
| Bank 14 || $38010-$3c010 || $8000-$bfff || Character initial stats || 47
|-
| Bank 15 || $3c010-$40010 || $8000-$bfff || Spell learning data || 282
|-
| Bank 16 || $40010-$44010 || $8000-$bfff || Battle system || 203
|-
| Bank 17 || $44010-$48010 || $8000-$bfff || Menu system || 236
|-
| Bank 18 || $48010-$4c010 || $8000-$bfff || Shop/item system || 206
|-
| Bank 19 || $4c010-$50010 || $8000-$bfff || '''Battle AI/Tactics''' || 284
|-
| Bank 20 || $50010-$54010 || $8000-$bfff || World map system || 194
|-
| Bank 21 || $54010-$58010 || $8000-$bfff || NPC/event system || 185
|-
| Bank 22 || $58010-$5c010 || $8000-$bfff || Event scripting || 232
|-
| Bank 23 || $5c010-$60010 || $8000-$bfff || Event scripting || 203
|-
| Bank 24 || $60010-$64010 || $8000-$bfff || Save system || 117
|-
| Bank 25 || $64010-$68010 || $8000-$bfff || Compression || 29
|-
| Bank 26 || $68010-$6c010 || $8000-$bfff || Data tables || 19
|-
| Bank 27 || $6c010-$70010 || $8000-$bfff || Experience/level system || 207
|-
| Bank 28 || $70010-$74010 || $8000-$bfff || Character stats || 123
|-
| Bank 29 || $74010-$78010 || $8000-$bfff || Equipment system || 207
|-
| Bank 30 || $78010-$7c010 || $8000-$bfff || Core routines || 293
|-
| Bank 31 || $7c010-$80010 || $c000-$ffff || '''Fixed bank''' || 239
|}

== Bank 19 - Battle AI and Tactics System ==

Bank 19 ($4c010-$50010) contains the battle AI and tactics system. This is one of the most complex banks in the game, managing all AI decision-making for the party members.

=== Tactics Tables ===

These tables control how each AI tactic affects battle calculations:

{| class="wikitable"
|-
! Address !! Size !! Description !! Used By
|-
| $ba74 || 49 bytes || Primary tactics/spell priority matrix (7×7) || AI spell selection
|-
| $baa5 || 48 bytes || Secondary tactics/spell data || Spell priority
|-
| $bad5 || 18 bytes || Tertiary tactics data || Edge cases
|-
| $bb3f || 9 bytes || Spell power table || Damage calculation
|-
| $bb49 || 9 bytes || Spell attribute table || Element/type
|-
| $bb84 || 7 bytes || Attack multiplier by tactics (one per tactic) || Physical damage
|-
| $bb8b || 7 bytes || Stat divisor/multiplier by tactics || Stat contribution
|-
| $bb92 || 7 bytes || Hit threshold by tactics || Hit rate
|}

=== Key Subroutines ===

{| class="wikitable"
|-
! Address !! Name !! Description !! Called From
|-
| $8038 || battle_entry || Main battle entry point || Fixed bank
|-
| $8088 || read_tactics || Read current tactics setting from $615b || battle_entry
|-
| $8176 || mul16 || 16-bit multiply by 16 (ASL×4) || Damage calc
|-
| $8187 || div16 || 16-bit divide by 16 (LSR×4) || Damage calc
|-
| $9212 || sum_party_stats || Calculate party stat totals || AI decisions
|-
| $805b || dispatch_action || Execute battle action based on tactics || battle_entry
|}

== Bank 31 - Fixed Bank ==

Bank 31 ($7c010-$80010) is the fixed bank, always mapped to $c000-$ffff. It contains core routines that must always be accessible regardless of which switchable banks are active.

=== Interrupt Vectors ===

Standard 6502 interrupt vectors at the end of the address space:

{| class="wikitable"
|-
! Address !! Vector !! Description
|-
| $fffa || NMI vector || Vertical blank interrupt
|-
| $fffc || Reset vector || Power-on/reset entry
|-
| $fffe || IRQ/BRK vector || IRQ and BRK instruction
|}

=== Party Data Access Routines ===

These routines provide consistent access to party and chapter state:

{| class="wikitable"
|-
! Address !! Description !! RAM Access !! Notes
|-
| $cc16 || Check party limit X || $6197 || X coordinate bounds
|-
| $cc1d || Check party limit Y || $6198 || Y coordinate bounds
|-
| $cc28 || Get current chapter || $615a || Returns 0-4
|-
| $f148 || Read chapter number || $615a || Chapter state read
|-
| $f164 || Increment chapter || $615a || Chapter progression
|-
| $f173 || Decrement chapter || $615a || Rarely used
|}

== Bank 06 - Monster Data ==

Bank 06 ($18010-$1c010) contains monster sprites and the primary monster data tables.

=== Monster Table Structure ===

Each monster record is 27 bytes ($1b). See [[Dragon Warrior IV:Enemies|Enemies]] for complete field documentation.

{| class="wikitable"
|-
! Offset !! Size !! Description
|-
| $8010 || varies || Monster data table start
|-
| $9000 || varies || Monster stat calculations
|}

=== Address Calculation ===

Monster data address = $18010 + (Monster_ID × $1b)

== CHR ROM ==

The CHR ROM contains pattern table data for graphics. The game uses 256KB of CHR ROM (16 banks of 16KB each).

{| class="wikitable"
|-
! Bank !! File Offset !! Size !! Description
|-
| CHR 0 || $80010-$84010 || 16KB || Title screen graphics
|-
| CHR 1 || $84010-$88010 || 16KB || Overworld tiles
|-
| CHR 2 || $88010-$8c010 || 16KB || Town/dungeon tiles
|-
| CHR 3 || $8c010-$90010 || 16KB || Character sprites
|-
| CHR 4 || $90010-$94010 || 16KB || Monster sprites (A)
|-
| CHR 5 || $94010-$98010 || 16KB || Monster sprites (B)
|-
| CHR 6 || $98010-$9c010 || 16KB || Battle backgrounds
|-
| CHR 7 || $9c010-$a0010 || 16KB || Font and text
|-
| CHR 8-15 || $a0010+ || 128KB || Additional graphics
|}

== Data Tables Quick Reference ==

Summary of key data locations across all banks:

{| class="wikitable"
|-
! Data Type !! Bank !! File Offset !! CPU Address
|-
| Monster table || 6 || $18010 || $8010
|-
| Item names || 10 || $28010 || $8010
|-
| Character stats || 14 || $38010 || $8010
|-
| Spell learning || 15 || $3c010 || $8010
|-
| Battle AI || 19 || $4c010 || $8010
|-
| Tactics tables || 19 || $4fb84 || $bb84
|-
| EXP tables || 27 || $6c010 || $8010
|}

== See Also ==

* [[Dragon Warrior IV:RAM_Map|RAM Map]] - Runtime memory layout
* [[Dragon Warrior IV:SRAM_Map|SRAM Map]] - Save data format
* [[Dragon Warrior IV:Enemies|Enemies]] - Monster data details
* [[Dragon Warrior IV:Battle_System|Battle System]] - AI and tactics

== External Links ==

* [https://github.com/TheAnsarya/dragon-warrior-4-info Dragon Warrior 4 Info Repository]
* [https://github.com/TheAnsarya/dragon-warrior-4-info/tree/main/disasm Disassembly files]

[[Category:Dragon Warrior IV]]
[[Category:ROM Maps]]

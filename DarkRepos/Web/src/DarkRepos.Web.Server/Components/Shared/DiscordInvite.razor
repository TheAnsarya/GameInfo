@namespace DarkRepos.Web.Components.Shared

@*
	DiscordInvite - Discord server invite card
	Usage: <DiscordInvite ServerName="Dark Repos" InviteCode="xxxxx" />
	Features:
	- Server name and description
	- Member count display (optional)
	- Online count display (optional)
	- Custom styling with brand colors
*@

<div class="discord-invite @(Compact ? "compact" : "")">
	<div class="discord-invite-header">
		<div class="discord-logo" aria-hidden="true">
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 127.14 96.36" width="24" height="24">
				<path fill="currentColor"
					d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z" />
			</svg>
		</div>
		<span class="discord-label">Join us on Discord</span>
	</div>

	<div class="discord-invite-body">
		<div class="discord-server-info">
			@if (!string.IsNullOrEmpty(ServerIconUrl))
			{
				<img src="@ServerIconUrl" alt="@ServerName server icon" class="discord-server-icon" loading="lazy" />
			}
			else
			{
				<div class="discord-server-icon discord-server-icon-placeholder">
					@GetServerInitials()
				</div>
			}

			<div class="discord-server-details">
				<h3 class="discord-server-name">@ServerName</h3>
				@if (!string.IsNullOrEmpty(Description) && !Compact)
				{
					<p class="discord-server-description">@Description</p>
				}
				<div class="discord-server-stats">
					@if (OnlineCount > 0)
					{
						<span class="discord-stat discord-online">
							<span class="discord-status-dot online" aria-hidden="true"></span>
							@FormatCount(OnlineCount) Online
						</span>
					}
					@if (MemberCount > 0)
					{
						<span class="discord-stat discord-members">
							<span class="discord-status-dot offline" aria-hidden="true"></span>
							@FormatCount(MemberCount) Members
						</span>
					}
				</div>
			</div>
		</div>
	</div>

	<div class="discord-invite-footer">
		<a href="@InviteUrl" target="_blank" rel="noopener noreferrer" class="discord-join-button">
			Join Server
		</a>
	</div>
</div>

@code {
	/// <summary>
	/// The Discord invite code (without the full URL).
	/// </summary>
	[Parameter]
	public string InviteCode { get; set; } = string.Empty;

	/// <summary>
	/// The name of the Discord server.
	/// </summary>
	[Parameter]
	public string ServerName { get; set; } = "Dark Repos";

	/// <summary>
	/// Optional description of the server.
	/// </summary>
	[Parameter]
	public string? Description { get; set; }

	/// <summary>
	/// URL to the server icon image.
	/// </summary>
	[Parameter]
	public string? ServerIconUrl { get; set; }

	/// <summary>
	/// Number of online members (0 to hide).
	/// </summary>
	[Parameter]
	public int OnlineCount { get; set; }

	/// <summary>
	/// Total member count (0 to hide).
	/// </summary>
	[Parameter]
	public int MemberCount { get; set; }

	/// <summary>
	/// Use compact layout without description.
	/// </summary>
	[Parameter]
	public bool Compact { get; set; }

	private string InviteUrl => $"https://discord.gg/{InviteCode}";

	private string GetServerInitials()
	{
		if (string.IsNullOrWhiteSpace(ServerName))
		{
			return "?";
		}

		var words = ServerName.Split(' ', StringSplitOptions.RemoveEmptyEntries);
		if (words.Length >= 2)
		{
			return $"{words[0][0]}{words[1][0]}".ToUpperInvariant();
		}

		return ServerName.Length >= 2 ? ServerName[..2].ToUpperInvariant() : ServerName.ToUpperInvariant();
	}

	private static string FormatCount(int count)
	{
		return count switch
		{
			>= 1000000 => $"{count / 1000000.0:0.#}M",
			>= 1000 => $"{count / 1000.0:0.#}K",
			_ => count.ToString()
		};
	}
}

@namespace DarkRepos.Web.Components.Shared

@*
	CodeBlock - Syntax-highlighted code display
	Usage: <CodeBlock Code="@code" Language="csharp" />
	Features:
	- Language label display
	- Copy to clipboard button
	- Line numbers (optional)
	- Scrollable content
*@

<div class="code-block @(ShowLineNumbers ? "with-lines" : "")">
	<div class="code-header">
		<span class="code-language">@GetLanguageLabel()</span>
		@if (Title is not null)
		{
			<span class="code-title">@Title</span>
		}
		<CopyButton Text="@Code" Label="Copy" CopiedLabel="Copied!" />
	</div>
	<div class="code-content">
		@if (ShowLineNumbers)
		{
			<div class="line-numbers" aria-hidden="true">
				@for (var i = 1; i <= LineCount; i++)
				{
					<span class="line-number">@i</span>
				}
			</div>
		}
		<pre class="code-pre"><code class="code-text language-@Language">@Code</code></pre>
	</div>
</div>

@code {
	/// <summary>
	/// The code to display.
	/// </summary>
	[Parameter, EditorRequired]
	public string Code { get; set; } = string.Empty;

	/// <summary>
	/// The programming language for syntax highlighting.
	/// </summary>
	[Parameter]
	public string Language { get; set; } = "text";

	/// <summary>
	/// Optional title for the code block.
	/// </summary>
	[Parameter]
	public string? Title { get; set; }

	/// <summary>
	/// Whether to show line numbers.
	/// </summary>
	[Parameter]
	public bool ShowLineNumbers { get; set; }

	/// <summary>
	/// Starting line number (for excerpts).
	/// </summary>
	[Parameter]
	public int StartLine { get; set; } = 1;

	/// <summary>
	/// Maximum height before scrolling (CSS value).
	/// </summary>
	[Parameter]
	public string? MaxHeight { get; set; }

	private int LineCount => Code?.Split('\n').Length ?? 0;

	private string GetLanguageLabel() => Language?.ToLowerInvariant() switch
	{
		"csharp" or "cs" => "C#",
		"javascript" or "js" => "JavaScript",
		"typescript" or "ts" => "TypeScript",
		"python" or "py" => "Python",
		"html" => "HTML",
		"css" => "CSS",
		"json" => "JSON",
		"xml" => "XML",
		"yaml" or "yml" => "YAML",
		"markdown" or "md" => "Markdown",
		"sql" => "SQL",
		"bash" or "shell" or "sh" => "Shell",
		"powershell" or "ps1" => "PowerShell",
		"razor" => "Razor",
		"asm" or "assembly" => "Assembly",
		"6502" => "6502 ASM",
		"65816" => "65816 ASM",
		"z80" => "Z80 ASM",
		"text" or "plain" => "Plain Text",
		null or "" => "Code",
		_ => Language.ToUpperInvariant()
	};
}

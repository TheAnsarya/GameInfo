@inject NavigationManager Navigation

<div class="search-box @(Large ? "large" : "") @(Expanded ? "expanded" : "")">
	<label class="visually-hidden" for="@InputId">@Placeholder</label>
	<input type="search" id="@InputId" class="search-input" placeholder="@Placeholder" @bind="Query"
		@bind:event="oninput" @onkeydown="HandleKeyDown" autocomplete="off" aria-label="@Placeholder" />
	<button type="button" class="search-button" @onclick="ExecuteSearch" aria-label="Search">
		<span class="search-icon">üîç</span>
	</button>
	@if (ShowShortcut && !string.IsNullOrEmpty(Shortcut))
	{
		<kbd class="search-shortcut">@Shortcut</kbd>
	}
</div>

@code {
	[Parameter]
	public string Placeholder { get; set; } = "Search games, tools, documentation...";

	[Parameter]
	public string? Query { get; set; }

	[Parameter]
	public EventCallback<string> QueryChanged { get; set; }

	[Parameter]
	public EventCallback<string> OnSearch { get; set; }

	[Parameter]
	public bool Large { get; set; } = false;

	[Parameter]
	public bool Expanded { get; set; } = false;

	[Parameter]
	public bool ShowShortcut { get; set; } = false;

	[Parameter]
	public string Shortcut { get; set; } = "Ctrl+K";

	[Parameter]
	public string SearchUrl { get; set; } = "/search";

	private string InputId => $"search-{Guid.NewGuid():N}"[..16];

	private async Task HandleKeyDown(KeyboardEventArgs e)
	{
		if (e.Key == "Enter")
		{
			await ExecuteSearch();
		}
	}

	private async Task ExecuteSearch()
	{
		if (OnSearch.HasDelegate)
		{
			await OnSearch.InvokeAsync(Query);
		}
		else if (!string.IsNullOrWhiteSpace(Query))
		{
			Navigation.NavigateTo($"{SearchUrl}?q={Uri.EscapeDataString(Query)}");
		}
	}
}
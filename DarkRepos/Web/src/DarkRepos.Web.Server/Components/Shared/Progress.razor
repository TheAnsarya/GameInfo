@namespace DarkRepos.Web.Components.Shared

<div class="progress @GetSizeClass() @CssClass" role="progressbar" aria-valuenow="@Value" aria-valuemin="0"
	aria-valuemax="@Max" aria-label="@(Label ?? "Progress")">
	<div class="progress-bar @GetVariantClass() @(Striped ? "progress-bar--striped" : "") @(Animated ? "progress-bar--animated" : "")"
		style="width: @GetPercentage()%">
		@if (ShowValue)
		{
			<span class="progress-value">@GetPercentage()%</span>
		}
	</div>
</div>

@if (!string.IsNullOrEmpty(Label))
{
	<div class="progress-label">@Label</div>
}

@code {
	/// <summary>
	/// Current progress value.
	/// </summary>
	[Parameter]
	public double Value { get; set; }

	/// <summary>
	/// Maximum value (default 100).
	/// </summary>
	[Parameter]
	public double Max { get; set; } = 100;

	/// <summary>
	/// Progress bar variant.
	/// </summary>
	[Parameter]
	public ProgressVariant Variant { get; set; } = ProgressVariant.Default;

	/// <summary>
	/// Progress bar size.
	/// </summary>
	[Parameter]
	public ProgressSize Size { get; set; } = ProgressSize.Medium;

	/// <summary>
	/// Whether to show striped pattern.
	/// </summary>
	[Parameter]
	public bool Striped { get; set; }

	/// <summary>
	/// Whether to animate the stripes.
	/// </summary>
	[Parameter]
	public bool Animated { get; set; }

	/// <summary>
	/// Whether to show the percentage value.
	/// </summary>
	[Parameter]
	public bool ShowValue { get; set; }

	/// <summary>
	/// Optional label below the progress bar.
	/// </summary>
	[Parameter]
	public string? Label { get; set; }

	/// <summary>
	/// Additional CSS classes.
	/// </summary>
	[Parameter]
	public string? CssClass { get; set; }

	private double GetPercentage()
	{
		if (Max <= 0) return 0;
		var percentage = (Value / Max) * 100;
		return Math.Clamp(percentage, 0, 100);
	}

	private string GetVariantClass() => Variant switch
	{
		ProgressVariant.Primary => "progress-bar--primary",
		ProgressVariant.Success => "progress-bar--success",
		ProgressVariant.Warning => "progress-bar--warning",
		ProgressVariant.Error => "progress-bar--error",
		ProgressVariant.Info => "progress-bar--info",
		_ => ""
	};

	private string GetSizeClass() => Size switch
	{
		ProgressSize.Small => "progress--small",
		ProgressSize.Large => "progress--large",
		_ => ""
	};

	public enum ProgressVariant
	{
		Default,
		Primary,
		Success,
		Warning,
		Error,
		Info
	}

	public enum ProgressSize
	{
		Small,
		Medium,
		Large
	}
}